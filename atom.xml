<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>知识与头发不可兼得</title>
  
  <subtitle>文杰的博客</subtitle>
  <link href="https://xwjahahahaha.github.io/atom.xml" rel="self"/>
  
  <link href="https://xwjahahahaha.github.io/"/>
  <updated>2021-10-28T15:29:47.961Z</updated>
  <id>https://xwjahahahaha.github.io/</id>
  
  <author>
    <name>DDDemons hide</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>动手实现一个docker引擎-1</title>
    <link href="https://xwjahahahaha.github.io/2021/10/28/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/Docker/%E5%8A%A8%E6%89%8B%E5%AE%9E%E8%B7%B5%E4%B8%80%E4%B8%AAdocker%E7%B3%BB%E5%88%97/%E5%8A%A8%E6%89%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAdocker%E5%BC%95%E6%93%8E-1/"/>
    <id>https://xwjahahahaha.github.io/2021/10/28/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/Docker/%E5%8A%A8%E6%89%8B%E5%AE%9E%E8%B7%B5%E4%B8%80%E4%B8%AAdocker%E7%B3%BB%E5%88%97/%E5%8A%A8%E6%89%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAdocker%E5%BC%95%E6%93%8E-1/</id>
    <published>2021-10-28T12:14:59.000Z</published>
    <updated>2021-10-28T15:29:47.961Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>学习自《自己动手写Docker》</p><p>作者：<a href="https://www.zhihu.com/people/chen-xian-lu-10/activities" target="_blank" rel="noopener">陈显鹭（花名：遥鹭）-阿里云高级研发工程师</a>等</p><p>京东购买链接：<a href="https://item.jd.com/10033552355433.html" target="_blank" rel="noopener">https://item.jd.com/10033552355433.html</a></p><p>其他资料：</p><ul><li><a href="https://www.cnblogs.com/heyanan/p/7800284.html" target="_blank" rel="noopener">https://www.cnblogs.com/heyanan/p/7800284.html</a></li></ul></blockquote><blockquote><p>我的主机环境：</p><ul><li>内核版本：Linux version 4.15.0-48-generic (buildd@lgw01-amd64-036) </li><li>Ubuntu 7.3.0-16ubuntu3  </li></ul></blockquote><a id="more"></a><p>docker已经成为了容器化技术的代表名词，即使是k8s大行其道的今天，docker也是k8s的基石。所以打算跟着书一起用一个系列从零开始学习编写docker引擎。</p><p>前提：学习过docker基本操作使用、golang的使用</p><p>记录重点与实际遇到的难点、bug</p><h1 id="一、容器与开发语言"><a href="#一、容器与开发语言" class="headerlink" title="一、容器与开发语言"></a>一、容器与开发语言</h1><p>​    docker最直观的理解：一个隔离的虚拟环境，封装了所有应用程序需要的一切在其中（代码、工具、系统依赖等），这样就可以称为“容器”，并且这样的容器是可以复制的（都是一个模子里刻出来的），而生成容器的模版就是“镜像”，镜像可以将所有系统级别依赖打包成为一个文件，所有镜像共享一个Kernel(在同一个宿主机下)。</p><h2 id="什么是Kernel？"><a href="#什么是Kernel？" class="headerlink" title="什么是Kernel？"></a><strong>什么是Kernel？</strong></h2><p>计算机系统的结构：</p><ol><li><strong>硬件：</strong>物理机（这是系统的底层结构或基础）是由内存（RAM）、处理器（或 CPU）以及输入/输出（I/O）设备（例如<a href="https://www.redhat.com/zh/topics/data-storage" target="_blank" rel="noopener">存储</a>、<a href="https://www.redhat.com/zh/topics/hyperconverged-infrastructure/what-is-software-defined-networking" target="_blank" rel="noopener">网络</a>和图形）组成的。其中，CPU 负责执行计算和内存的读写操作。</li><li><strong>Linux 内核：</strong>操作系统的核心。（明白了吗？内核正居于核心位置。）<font color='#e54d42'>它是驻留在内存中的软件，用于告诉 CPU 要执行哪些操作。</font></li><li><strong>用户进程：</strong>这些是内核所<a href="https://www.redhat.com/zh/topics/management" target="_blank" rel="noopener">管理</a>的运行程序。用户进程共同构成了用户空间。用户进程有时也简称为<em>进程</em>。内核还允许这些进程和服务器彼此进行通信（称为进程间通信或 IPC）。</li></ol><h2 id="docker容器特点："><a href="#docker容器特点：" class="headerlink" title="docker容器特点："></a>docker容器特点：</h2><ol><li>轻量级： 占用内存少、磁盘使用率高、启动快 （相比于虚拟机）</li><li>开放：基于开放标准，可运行在主流linux、windows操作系统</li><li>安全：隔离保护</li></ol><h2 id="容器与虚拟机"><a href="#容器与虚拟机" class="headerlink" title="容器与虚拟机"></a>容器与虚拟机</h2><p>虚拟机（也被称为guest os）是一种模拟系统，即在软件层面上通过模拟硬件的输入和输出，让虚拟机的操作系统得以运行在<strong>没有物理硬件的环境中</strong>（也就是宿主机的操作系统上），其中能够模拟出硬件输入输出，让虚拟机的操作系统可以启动起来的程序，被叫做<strong>hypervisor</strong>， hypervisor能够创建出虚拟硬件。</p><p>虚拟机的缺点所在：</p><ul><li>每个虚拟机一般都有自己的kernel，并且开启之前需要先做开机自检，启动kernel，启动用户进程等一系列行为，启动很慢</li><li>虚拟机还需要模拟硬件的输入输出，效率很差</li><li>虚拟机需要包含用户的程序、函数库、整个客户操作系统，占用空间大</li></ul><p>docked的改进：</p><ul><li><p>docker<strong>所有容器（包括宿主机）之间共享内核kernel</strong>，各个容器在宿主机上相互隔离在用户态（cpu低级访问权限，一般程序的权限）下运行。docker的kernel version由宿主机决定</p><blockquote><p><font color='#39b54a'>因为共享kernel，所以不需要费大精力模拟硬件的输入输出，只需要模拟kernel的输入输出（因为共享），所以这种虚拟化也叫做<strong>操作系统层虚拟化</strong></font>  <a href="http://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Operating-system-level_virtualization">Operating-system-level virtualization</a></p></blockquote></li><li><p>docker通过隔离容器不让容器使用宿主机的文件、进程、内存等系统实现封闭的环境（具体操作会在后面详述），让用户感受到容器有自己的文件、进程等系统（类似于虚拟机）</p></li><li><p>容器不与任何基础设施绑定，移植性好</p></li></ul><p>虚拟机与docker架构对比：</p><p>虚拟机：</p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/image-20211028205122292.png" alt="image-20211028205122292" style="zoom: 50%;" /><p>docker容器：</p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/image-20211028205147983.png" alt="image-20211028205147983" style="zoom: 50%;" /><p>正因为这些特点，docker能够<strong>加速开发效率，隔离移植、使用环境</strong>，容器的合作分享可以使用Docker Hub（类似于github，能够管理、更新docker镜像的仓库）</p><h1 id="二、基础技术"><a href="#二、基础技术" class="headerlink" title="二、基础技术"></a>二、基础技术</h1><h2 id="2-1-容器的启动过程"><a href="#2-1-容器的启动过程" class="headerlink" title="2.1 容器的启动过程"></a>2.1 容器的启动过程</h2><p>linux进程实现的步骤：</p><ol><li>在内存中将主进程复制一份得到子进程，此时主、子进程上下文完全一致</li><li>设置子进程的pid、parent_pid等其他与主进程不一样的内容（所以子进程大部分资源还是与主进程一致的）</li></ol><p>docker需要制造一个虚拟的进程，所以进程的实现需要多做几步：</p><ol><li>自定义rootfs（根文件系统），将宿主机的一个文件目录设置为虚拟机的根目录，例如<code>rootfs=/root/ubuntu</code>,在容器中其就是<code>/</code></li><li>将自身的pid映射为0，并让其看不到其他任何进程pid，让其在容器中唯一</li><li>用户名隔离，可以把用户名变为<code>root</code></li><li><code>hostname</code>隔离，可以领取一个<code>hostname</code></li><li>IPC隔离，隔离进程之间的相互通信</li><li>网络隔离，隔离进程与主机之间的网络</li></ol><blockquote><p><font color='#39b54a'>这些隔离方式都是调用linux系统内置（kernel）的隔离方法：<a href="https://link.zhihu.com/?target=http%3A//man7.org/linux/man-pages/man2/clone.2.html">clone(2) - Linux manual page</a></font></p></blockquote><p><font color='#e54d42'><strong>docker是内核的搬运工：</strong>docker实现这些隔离就是调用内核kernel支持的已有的内置隔离资源的方法，当然在其上也有一些拓展，例如资源隔离等</font></p><p>所以出现了docker两个特性：</p><ol><li>启动速度快：因为本质上<strong>容器中的进程与宿主机进程没有很大区别</strong>，<font color='#e54d42'><strong>本质上docker启动的就是一个被隔离的进程</strong></font>，共享了很多资源（虽然多了很多步骤）</li><li>docker对linux内核版本有需求（版本号大于3.10），因为需要内核支持一些隔离特性的方法</li></ol><p><strong>对于容器启动后再新创建的进程，因为在创建容器时已经实现了与宿主机的资源隔离，所以在容器中新创建的进程天然就与宿主机实现了资源隔离！所以只需要刚开始的一次隔离（上面的6步）后面的进程就不需要再做了。</strong></p><p>=&gt; 找到启动快的原因：</p><p>linux启动流程如下图：</p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/8geyMe.png" alt="8geyMe" style="zoom: 50%;" /><p>问：启动容器需要执行以上几步？ 答：0步</p><h2 id="2-2-Linux-namespace"><a href="#2-2-Linux-namespace" class="headerlink" title="2.2 Linux namespace"></a>2.2 Linux namespace</h2><h3 id="1-基础介绍"><a href="#1-基础介绍" class="headerlink" title="1. 基础介绍"></a>1. 基础介绍</h3><p>Linux实现隔离的方式： <a href="http://link.zhihu.com/?target=http%3A//man7.org/linux/man-pages/man7/namespaces.7.html">namespaces(7)</a></p><p>命名空间将全局系统资源包装在一个抽象中 使名称空间内的进程看起来拥有自己的全局资源的独立实例。全局资源的修改对同一个命名空间下的其他进程是可见的，对于其他命名空间是不可见的。命名空间的一个用途是实现容器。</p><p>Linux Namespace各种命名空间：</p><p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/ItNpxb.png" alt="ItNpxb"></p><p>第二列显示了用于在各种api中指定名称空间类型的标志值（系统调用参数），第三列标识了手册页中关于命名空间的详细信息，最后一列标识命名空间对应隔离的资源</p><p>Namespace能够实现在同一台主机下UID级别的隔离，给每一个UID的用户虚拟化出一个Namespace，这样多个用户之间可以访问系统资源的同时互相之间还实现了隔离。</p><p>从每个用户的角度看，每个命名空间都像一台单独的linux一样，有自己的init进程，并且pid不断递增</p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/image-20211028230603400.png" alt="image-20211028230603400" style="zoom:67%;" /><p>例如上图：</p><p>用户A在命名空间A中认为自己的1号进程就是init进程，同理B如此。但是实际上都是分别映射到主进程3，4进程，从host的角度看只是3、4号进程虚拟化出来的一个空间而已。</p><h3 id="2-命名空间API"><a href="#2-命名空间API" class="headerlink" title="2.命名空间API"></a>2.命名空间API</h3><p>目前Namespace的API的系统调用：</p><table><thead><tr><th>API</th><th>官方解释</th><th>简单解释</th></tr></thead><tbody><tr><td>clone(2)</td><td>系统调用创建一个新进程。如果调用的flags参数指定了上面列出的一个或多个<code>CLONE_NEW*</code>标志，则新的命名空间是为每个标志创建，并且子进程被创建为               这些命名空间的成员。</td><td>创建一个新进程，可以通过<code>CLONE_NEW*</code>参数指定哪些命名空间被创建，并且他们的子进程也会被包含在这些Namespace中</td></tr><tr><td>setns(2)</td><td>系统调用允许调用进程加入现有的命名空间。</td><td>将一个进程加入现有命名空间</td></tr><tr><td>unshare(2)</td><td>系统调用的调用进程移动到               新的命名空间。如果调用的标志参数 指定列出的一个或多个<code>CLONE_NEW*</code>标志上面，然后为每个标志创建新的命名空间，并且调用进程成为这些命名空间的成员。（这个系统调用还实现了许多功能与命名空间无关。）</td><td>调用进程移动到新的命名空间</td></tr><tr><td>ioctl(2)</td><td>发现有关命名空间的信息。</td><td>输出命名空间的信息</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;学习自《自己动手写Docker》&lt;/p&gt;
&lt;p&gt;作者：&lt;a href=&quot;https://www.zhihu.com/people/chen-xian-lu-10/activities&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;陈显鹭（花名：遥鹭）-阿里云高级研发工程师&lt;/a&gt;等&lt;/p&gt;
&lt;p&gt;京东购买链接：&lt;a href=&quot;https://item.jd.com/10033552355433.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://item.jd.com/10033552355433.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;其他资料：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.cnblogs.com/heyanan/p/7800284.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.cnblogs.com/heyanan/p/7800284.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;我的主机环境：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;内核版本：Linux version 4.15.0-48-generic (buildd@lgw01-amd64-036) &lt;/li&gt;
&lt;li&gt;Ubuntu 7.3.0-16ubuntu3  &lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="technical" scheme="https://xwjahahahaha.github.io/categories/technical/"/>
    
    
    <category term="golang" scheme="https://xwjahahahaha.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>146.LRU缓存机制</title>
    <link href="https://xwjahahahaha.github.io/2021/10/28/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E8%AE%BE%E8%AE%A1%E7%B1%BB/146-LRU%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/"/>
    <id>https://xwjahahahaha.github.io/2021/10/28/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E8%AE%BE%E8%AE%A1%E7%B1%BB/146-LRU%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/</id>
    <published>2021-10-28T08:37:37.000Z</published>
    <updated>2021-10-28T08:38:57.101Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://leetcode-cn.com/problems/lru-cache/" target="_blank" rel="noopener">146. LRU 缓存机制</a></p><p>难度中等1692</p><p>运用你所掌握的数据结构，设计和实现一个 <a href="https://baike.baidu.com/item/LRU" target="_blank" rel="noopener">LRU (最近最少使用) 缓存机制</a> 。</p><p>实现 <code>LRUCache</code> 类：</p><ul><li><p><code>LRUCache(int capacity)</code> 以正整数作为容量 <code>capacity</code> 初始化 LRU 缓存</p></li><li><p><code>int get(int key)</code> 如果关键字 <code>key</code> 存在于缓存中，则返回关键字的值，否则返回 <code>-1</code> 。</p></li><li><p><code>void put(int key, int value)</code> 如果关键字已经存在，则变更其数据值；如果关键字不存在，则插入该组「关键字-值」。当缓存容量达到上限时，它应该在写入新数据之前删除最久未使用的数据值，从而为新的数据值留出空间。</p><a id="more"></a></li></ul><p><strong>进阶</strong>：你是否可以在 <code>O(1)</code> 时间复杂度内完成这两种操作？</p><p><strong>示例：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">输入</span><br><span class="line">[&quot;LRUCache&quot;, &quot;put&quot;, &quot;put&quot;, &quot;get&quot;, &quot;put&quot;, &quot;get&quot;, &quot;put&quot;, &quot;get&quot;, &quot;get&quot;, &quot;get&quot;]</span><br><span class="line">[[2], [1, 1], [2, 2], [1], [3, 3], [2], [4, 4], [1], [3], [4]]</span><br><span class="line">输出</span><br><span class="line">[null, null, null, 1, null, -1, null, -1, 3, 4]</span><br><span class="line"></span><br><span class="line">解释</span><br><span class="line">LRUCache lRUCache &#x3D; new LRUCache(2);</span><br><span class="line">lRUCache.put(1, 1); &#x2F;&#x2F; 缓存是 &#123;1&#x3D;1&#125;</span><br><span class="line">lRUCache.put(2, 2); &#x2F;&#x2F; 缓存是 &#123;1&#x3D;1, 2&#x3D;2&#125;</span><br><span class="line">lRUCache.get(1);    &#x2F;&#x2F; 返回 1</span><br><span class="line">lRUCache.put(3, 3); &#x2F;&#x2F; 该操作会使得关键字 2 作废，缓存是 &#123;1&#x3D;1, 3&#x3D;3&#125;</span><br><span class="line">lRUCache.get(2);    &#x2F;&#x2F; 返回 -1 (未找到)</span><br><span class="line">lRUCache.put(4, 4); &#x2F;&#x2F; 该操作会使得关键字 1 作废，缓存是 &#123;4&#x3D;4, 3&#x3D;3&#125;</span><br><span class="line">lRUCache.get(1);    &#x2F;&#x2F; 返回 -1 (未找到)</span><br><span class="line">lRUCache.get(3);    &#x2F;&#x2F; 返回 3</span><br><span class="line">lRUCache.get(4);    &#x2F;&#x2F; 返回 4</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>1 &lt;= capacity &lt;= 3000</code></li><li><code>0 &lt;= key &lt;= 10000</code></li><li><code>0 &lt;= value &lt;= 105</code></li><li>最多调用 <code>2 * 105</code> 次 <code>get</code> 和 <code>put</code></li></ul><h2 id="解题思路及代码"><a href="#解题思路及代码" class="headerlink" title="解题思路及代码"></a>解题思路及代码</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Hash表 + 双向链表</span></span><br><span class="line"><span class="comment">// Hash表实现链表节点的O(1)访问</span></span><br><span class="line"><span class="comment">// 双向链表实现访问时间顺序以及交换</span></span><br><span class="line"><span class="keyword">type</span> LRUCache <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// map + 双向链表</span></span><br><span class="line">    linkMap <span class="keyword">map</span>[<span class="keyword">int</span>]*node</span><br><span class="line">    list *ToWayLinkedList</span><br><span class="line"></span><br><span class="line">    dataMap <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span></span><br><span class="line">    <span class="built_in">len</span> <span class="keyword">int</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">(capacity <span class="keyword">int</span>)</span> <span class="title">LRUCache</span></span> &#123;</span><br><span class="line">   <span class="keyword">return</span> LRUCache&#123;<span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]*node), NewToWayLinkedList(), <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>), capacity&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *LRUCache)</span> <span class="title">Get</span><span class="params">(key <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> _, has := this.dataMap[key]; !has &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 更新访问时间</span></span><br><span class="line">    this.list.Update(this.linkMap[key])</span><br><span class="line">    <span class="keyword">return</span> this.dataMap[key]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *LRUCache)</span> <span class="title">Put</span><span class="params">(key <span class="keyword">int</span>, value <span class="keyword">int</span>)</span></span>  &#123;</span><br><span class="line">    _, hasKey := this.dataMap[key]      <span class="comment">//注意： 如果当前达到容量上限但是原本的键存在则依然更新</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(this.dataMap) &lt; this.<span class="built_in">len</span> || hasKey &#123;</span><br><span class="line">        <span class="comment">// 未满，直接存储</span></span><br><span class="line">        <span class="keyword">if</span> _, has := this.dataMap[key]; has &#123;</span><br><span class="line">            <span class="comment">// 更新操作</span></span><br><span class="line">            this.dataMap[key] = value</span><br><span class="line">            <span class="comment">// 更新时间</span></span><br><span class="line">            this.list.Update(this.linkMap[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 创建操作</span></span><br><span class="line">            this.dataMap[key] = value</span><br><span class="line">            this.linkMap[key] = this.list.Insert(key)   <span class="comment">// 创建链表节点</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 满了，替换存储</span></span><br><span class="line">        <span class="comment">// 删除当前时间最久的</span></span><br><span class="line">        delNode := this.list.DeleteFirst()</span><br><span class="line">        <span class="built_in">delete</span>(this.linkMap, delNode.data)      <span class="comment">// 注意：这里删除的是最久未使用节点的key</span></span><br><span class="line">        <span class="built_in">delete</span>(this.dataMap, delNode.data)</span><br><span class="line">        <span class="comment">// 加入新的节点</span></span><br><span class="line">        this.dataMap[key] = value</span><br><span class="line">        this.linkMap[key] = this.list.Insert(key)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ToWayLinkedList <span class="keyword">struct</span> &#123;</span><br><span class="line">    head *node      <span class="comment">// 头节点</span></span><br><span class="line">    tail *node      <span class="comment">// 尾节点</span></span><br><span class="line">    <span class="built_in">len</span> <span class="keyword">int</span>         <span class="comment">// 节点数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> node <span class="keyword">struct</span> &#123;</span><br><span class="line">    data <span class="keyword">int</span>        </span><br><span class="line">    pre *node       <span class="comment">// 前指针</span></span><br><span class="line">    next *node      <span class="comment">// 后指针</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新建一个双向链表</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewToWayLinkedList</span><span class="params">()</span> *<span class="title">ToWayLinkedList</span></span> &#123;</span><br><span class="line">    head, tail := &amp;node&#123;<span class="number">-1</span>, <span class="literal">nil</span>, <span class="literal">nil</span>&#125;, &amp;node&#123;<span class="number">-1</span>, <span class="literal">nil</span>, <span class="literal">nil</span>&#125;</span><br><span class="line">    head.next = tail</span><br><span class="line">    tail.pre = head</span><br><span class="line">    <span class="keyword">return</span> &amp;ToWayLinkedList&#123;head, tail, <span class="number">0</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 尾部插入一个节点</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *ToWayLinkedList)</span> <span class="title">Insert</span><span class="params">(data <span class="keyword">int</span>)</span> *<span class="title">node</span></span> &#123;</span><br><span class="line">    newNode := &amp;node&#123;data, <span class="literal">nil</span>, <span class="literal">nil</span>&#125;</span><br><span class="line">    l.tail.pre.next = newNode</span><br><span class="line">    newNode.next = l.tail</span><br><span class="line">    newNode.pre = l.tail.pre</span><br><span class="line">    l.tail.pre = newNode</span><br><span class="line">    l.<span class="built_in">len</span> ++</span><br><span class="line">    <span class="keyword">return</span> newNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除首节点</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *ToWayLinkedList)</span> <span class="title">DeleteFirst</span><span class="params">()</span> *<span class="title">node</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> l.<span class="built_in">len</span> == <span class="number">0</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"not have node"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    delNode := l.head.next</span><br><span class="line">    l.head.next = l.head.next.next</span><br><span class="line">    delNode.pre = <span class="literal">nil</span></span><br><span class="line">    delNode.next = <span class="literal">nil</span></span><br><span class="line">    l.head.next.pre = l.head</span><br><span class="line">    l.<span class="built_in">len</span> --</span><br><span class="line">    <span class="keyword">return</span> delNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将特定节点移动到尾部</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *ToWayLinkedList)</span> <span class="title">Update</span><span class="params">(kNode *node)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> kNode.next == l.tail &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 删除原本位置</span></span><br><span class="line">    preNode := kNode.pre</span><br><span class="line">    preNode.next = preNode.next.next</span><br><span class="line">    kNode.pre = <span class="literal">nil</span></span><br><span class="line">    kNode.next = <span class="literal">nil</span></span><br><span class="line">    preNode.next.pre = preNode</span><br><span class="line">    <span class="comment">// 插入末尾</span></span><br><span class="line">    l.tail.pre.next = kNode</span><br><span class="line">    kNode.next = l.tail</span><br><span class="line">    kNode.pre = l.tail.pre</span><br><span class="line">    l.tail.pre = kNode</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your LRUCache object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * obj := Constructor(capacity);</span></span><br><span class="line"><span class="comment"> * param_1 := obj.Get(key);</span></span><br><span class="line"><span class="comment"> * obj.Put(key,value);</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://leetcode-cn.com/problems/lru-cache/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;146. LRU 缓存机制&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;难度中等1692&lt;/p&gt;
&lt;p&gt;运用你所掌握的数据结构，设计和实现一个 &lt;a href=&quot;https://baike.baidu.com/item/LRU&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;LRU (最近最少使用) 缓存机制&lt;/a&gt; 。&lt;/p&gt;
&lt;p&gt;实现 &lt;code&gt;LRUCache&lt;/code&gt; 类：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;LRUCache(int capacity)&lt;/code&gt; 以正整数作为容量 &lt;code&gt;capacity&lt;/code&gt; 初始化 LRU 缓存&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;int get(int key)&lt;/code&gt; 如果关键字 &lt;code&gt;key&lt;/code&gt; 存在于缓存中，则返回关键字的值，否则返回 &lt;code&gt;-1&lt;/code&gt; 。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;void put(int key, int value)&lt;/code&gt; 如果关键字已经存在，则变更其数据值；如果关键字不存在，则插入该组「关键字-值」。当缓存容量达到上限时，它应该在写入新数据之前删除最久未使用的数据值，从而为新的数据值留出空间。&lt;/p&gt;</summary>
    
    
    
    <category term="technical" scheme="https://xwjahahahaha.github.io/categories/technical/"/>
    
    <category term="leetcode" scheme="https://xwjahahahaha.github.io/categories/technical/leetcode/"/>
    
    
  </entry>
  
  <entry>
    <title>日记_0232</title>
    <link href="https://xwjahahahaha.github.io/2021/10/28/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/%E6%97%A5%E8%AE%B0/2021-10/%E6%97%A5%E8%AE%B0-0232/"/>
    <id>https://xwjahahahaha.github.io/2021/10/28/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/%E6%97%A5%E8%AE%B0/2021-10/%E6%97%A5%E8%AE%B0-0232/</id>
    <published>2021-10-28T01:52:30.000Z</published>
    <updated>2021-10-28T15:30:06.947Z</updated>
    
    <content type="html"><![CDATA[<h2 id="学习规划"><a href="#学习规划" class="headerlink" title="学习规划:"></a>学习规划:</h2><h3 id="8月"><a href="#8月" class="headerlink" title="8月"></a>8月</h3><ul><li><input checked="" disabled="" type="checkbox"> cosmos项目架构熟悉,<del>做完全部的案例</del>,<del>并且熟悉SDK</del></li><li><input checked="" disabled="" type="checkbox"> 科技部编程比赛项目实现(使用cosmos)</li><li><input checked="" disabled="" type="checkbox"> Go公链实现项目(simple_bitcoin)</li><li><input checked="" disabled="" type="checkbox"> 专利一篇(金链积分)</li><li><input checked="" disabled="" type="checkbox"> 华为区块链比赛</li><li><input checked="" disabled="" type="checkbox"> 第一篇论文初稿(blockchain + FL)  </li></ul><h3 id="9月"><a href="#9月" class="headerlink" title="9月"></a>9月</h3><ul><li><input checked="" disabled="" type="checkbox"> 论文实验 编码实现FedSharing（Cosmos、p2p）)</li></ul><a id="more"></a><h3 id="10月"><a href="#10月" class="headerlink" title="10月"></a>10月</h3><ul><li><input checked="" disabled="" type="checkbox"> 第一篇投稿</li></ul><h3 id="11月"><a href="#11月" class="headerlink" title="11月"></a>11月</h3><ul><li><input disabled="" type="checkbox"> 实习：1.go云服务、云容器 2.区块链</li><li><input disabled="" type="checkbox"> 项目一：docker从0实现</li><li><input disabled="" type="checkbox"> 项目二：简易Baas平台（Fabric、k8s、go-vue-admin）</li><li><input disabled="" type="checkbox"> 看面经（语言基础）</li><li><input disabled="" type="checkbox"> 刷题（算法基础）</li></ul><h3 id="算法刷题"><a href="#算法刷题" class="headerlink" title="算法刷题"></a>算法刷题</h3><p>剑指offer刷完（47）+ 代码随想录专题（180）+ 老题目（120）$\approx$ 350（230新题 + 120老题）</p><p>11月截止，工作日：60天  =&gt; 一天4道新题 + 2道老题</p><h2 id="今日完成的任务："><a href="#今日完成的任务：" class="headerlink" title="今日完成的任务："></a>今日完成的任务：</h2><ul><li><input checked="" disabled="" type="checkbox"> 上午：看go、面经</li><li><input checked="" disabled="" type="checkbox"> 下午：刷leetcode 2道老题+1道新题<ul><li><input checked="" disabled="" type="checkbox"> 堆排序</li><li><input checked="" disabled="" type="checkbox"> LRU缓存机制</li><li><input checked="" disabled="" type="checkbox"> 最大子序列和</li></ul></li><li><input checked="" disabled="" type="checkbox"> 晚上：做项目docker<ul><li><input checked="" disabled="" type="checkbox"> 第一～二章</li></ul></li></ul><h2 id="今日自省"><a href="#今日自省" class="headerlink" title="今日自省"></a>今日自省</h2>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;学习规划&quot;&gt;&lt;a href=&quot;#学习规划&quot; class=&quot;headerlink&quot; title=&quot;学习规划:&quot;&gt;&lt;/a&gt;学习规划:&lt;/h2&gt;&lt;h3 id=&quot;8月&quot;&gt;&lt;a href=&quot;#8月&quot; class=&quot;headerlink&quot; title=&quot;8月&quot;&gt;&lt;/a&gt;8月&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; cosmos项目架构熟悉,&lt;del&gt;做完全部的案例&lt;/del&gt;,&lt;del&gt;并且熟悉SDK&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 科技部编程比赛项目实现(使用cosmos)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; Go公链实现项目(simple_bitcoin)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 专利一篇(金链积分)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 华为区块链比赛&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 第一篇论文初稿(blockchain + FL)  &lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;9月&quot;&gt;&lt;a href=&quot;#9月&quot; class=&quot;headerlink&quot; title=&quot;9月&quot;&gt;&lt;/a&gt;9月&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 论文实验 编码实现FedSharing（Cosmos、p2p）)&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="随笔" scheme="https://xwjahahahaha.github.io/categories/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="每日一记" scheme="https://xwjahahahaha.github.io/categories/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/"/>
    
    
    <category term="每日一记" scheme="https://xwjahahahaha.github.io/tags/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>堆的实现</title>
    <link href="https://xwjahahahaha.github.io/2021/10/27/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%A0%86%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97/%E5%A0%86%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
    <id>https://xwjahahahaha.github.io/2021/10/27/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%A0%86%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97/%E5%A0%86%E7%9A%84%E5%AE%9E%E7%8E%B0/</id>
    <published>2021-10-27T15:14:33.000Z</published>
    <updated>2021-10-28T06:14:59.829Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>实现一个建议堆</p><a id="more"></a><h2 id="解题思路及代码"><a href="#解题思路及代码" class="headerlink" title="解题思路及代码"></a>解题思路及代码</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Heap <span class="keyword">interface</span> &#123;</span><br><span class="line">Len(heap *MyHeap) <span class="keyword">int</span></span><br><span class="line">Swap(i, j <span class="keyword">int</span>)</span><br><span class="line">Compare(i, j <span class="keyword">int</span>) <span class="keyword">bool</span></span><br><span class="line">ShiftUp(value <span class="keyword">int</span>)</span><br><span class="line">ShiftDown()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现一个小顶堆</span></span><br><span class="line"><span class="keyword">type</span> MyHeap <span class="keyword">struct</span> &#123;</span><br><span class="line">items []<span class="keyword">int</span></span><br><span class="line">k <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新建一个堆实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewHeap</span><span class="params">(size <span class="keyword">int</span>)</span> *<span class="title">MyHeap</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;MyHeap&#123;<span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">1</span>), size&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 堆的大小</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *MyHeap)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(h.items) - <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 比较堆的两个元素大小</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *MyHeap)</span> <span class="title">Compare</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> i &lt;= <span class="number">0</span> || j &lt;= <span class="number">0</span> || i &gt; h.k || j &gt; h.k &#123;</span><br><span class="line">fmt.Println(<span class="string">"Compare error"</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> h.items[i] &gt; h.items[j]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 交换元素</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *MyHeap)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> i &lt;= <span class="number">0</span> || j &lt;= <span class="number">0</span> || i &gt; h.k || j &gt; h.k &#123;</span><br><span class="line">fmt.Println(<span class="string">"Swap error"</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">h.items[i], h.items[j] = h.items[j], h.items[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上浮，新加入一个元素并重新调整堆</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *MyHeap)</span> <span class="title">ShiftUp</span><span class="params">(value <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="comment">// 检查堆是否已满</span></span><br><span class="line"><span class="keyword">if</span> h.k == h.Len() &#123;</span><br><span class="line">fmt.Println(<span class="string">"ShiftUp error"</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">h.items = <span class="built_in">append</span>(h.items, value)</span><br><span class="line"><span class="comment">// 调整, 依次将新加入节点与其父节点比较</span></span><br><span class="line">index := <span class="built_in">len</span>(h.items)<span class="number">-1</span>          <span class="comment">// 比较过程中使用的指针</span></span><br><span class="line"><span class="keyword">for</span> index &gt; <span class="number">0</span> &amp;&amp; index&gt;&gt;<span class="number">1</span> &gt; <span class="number">0</span> &amp;&amp; h.Compare(index&gt;&gt;<span class="number">1</span>, index) &#123;</span><br><span class="line"><span class="comment">// 如果有父节点并且当前值小于父节点（最小堆）则交换</span></span><br><span class="line">h.Swap(index, index&gt;&gt;<span class="number">1</span>)</span><br><span class="line">index &gt;&gt;= <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下沉，删除根节点元素并重新平衡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *MyHeap)</span> <span class="title">ShiftDown</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// 检查是否为空堆</span></span><br><span class="line"><span class="keyword">if</span> h.Len() == <span class="number">0</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"ShiftDown error"</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 将最底部元素替换堆根节点</span></span><br><span class="line">h.items[<span class="number">1</span>] = h.items[h.Len()]       <span class="comment">// 注意：最后一个元素的下标就是Len</span></span><br><span class="line">h.items = h.items[:h.Len()]         <span class="comment">// 剔除最后一个元素</span></span><br><span class="line"><span class="comment">// 重新调整堆结构特性, 从根节点往下</span></span><br><span class="line">index, minPos := <span class="number">1</span>, <span class="number">1</span>                   <span class="comment">// minPos表示三者中最小的位置</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="comment">// 如果左右孩子都存在，那么找到minPos</span></span><br><span class="line"><span class="keyword">if</span> (index &lt;&lt; <span class="number">1</span>) &lt;= h.Len() &amp;&amp; h.Compare(index, index &lt;&lt; <span class="number">1</span>) &#123;</span><br><span class="line">minPos = index &lt;&lt; <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (index &lt;&lt; <span class="number">1</span> | <span class="number">1</span>) &lt;= h.Len() &amp;&amp; h.Compare(minPos, index &lt;&lt; <span class="number">1</span> | <span class="number">1</span>) &#123;</span><br><span class="line">minPos = index &lt;&lt; <span class="number">1</span> | <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 交换</span></span><br><span class="line"><span class="keyword">if</span> minPos == index &#123;</span><br><span class="line"><span class="comment">// 如果没变化，说明无需调整，已经满足结构特点</span></span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">h.Swap(minPos, index)</span><br><span class="line"><span class="comment">// 更新下一个调整考察点</span></span><br><span class="line">index = minPos</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一般情况下堆的数据结构应该是一个二位数组，一维表示对象名，二维则表示优先值/属性值，可以用空接口实现</p><p>堆排序(借助于上面的最小堆)：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">arr := []<span class="keyword">int</span>&#123;<span class="number">8</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">7</span>&#125;</span><br><span class="line">fmt.Println(<span class="string">"堆排序结果: "</span>, HeapSort(arr))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 堆排序</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HeapSort</span><span class="params">(arr []<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line"><span class="comment">// 构造小顶堆</span></span><br><span class="line">minHeap := NewHeap(<span class="built_in">len</span>(arr))</span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> arr &#123;</span><br><span class="line">minHeap.ShiftUp(v)</span><br><span class="line">&#125;</span><br><span class="line">ret := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">range</span> arr &#123;</span><br><span class="line"><span class="comment">// 删除堆顶元素，重新构建堆结构</span></span><br><span class="line"><span class="comment">// 堆顶加入结果集合</span></span><br><span class="line">ret = <span class="built_in">append</span>(ret, minHeap.ShiftDown())</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;实现一个建议堆&lt;/p&gt;</summary>
    
    
    
    <category term="technical" scheme="https://xwjahahahaha.github.io/categories/technical/"/>
    
    <category term="leetcode" scheme="https://xwjahahahaha.github.io/categories/technical/leetcode/"/>
    
    
    <category term="golang" scheme="https://xwjahahahaha.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>日记_0231</title>
    <link href="https://xwjahahahaha.github.io/2021/10/27/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/%E6%97%A5%E8%AE%B0/2021-10/%E6%97%A5%E8%AE%B0-0231/"/>
    <id>https://xwjahahahaha.github.io/2021/10/27/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/%E6%97%A5%E8%AE%B0/2021-10/%E6%97%A5%E8%AE%B0-0231/</id>
    <published>2021-10-27T02:13:24.000Z</published>
    <updated>2021-10-27T15:19:34.168Z</updated>
    
    <content type="html"><![CDATA[<h2 id="学习规划"><a href="#学习规划" class="headerlink" title="学习规划:"></a>学习规划:</h2><h3 id="8月"><a href="#8月" class="headerlink" title="8月"></a>8月</h3><ul><li><input checked="" disabled="" type="checkbox"> cosmos项目架构熟悉,<del>做完全部的案例</del>,<del>并且熟悉SDK</del></li><li><input checked="" disabled="" type="checkbox"> 科技部编程比赛项目实现(使用cosmos)</li><li><input checked="" disabled="" type="checkbox"> Go公链实现项目(simple_bitcoin)</li><li><input checked="" disabled="" type="checkbox"> 专利一篇(金链积分)</li><li><input checked="" disabled="" type="checkbox"> 华为区块链比赛</li><li><input checked="" disabled="" type="checkbox"> 第一篇论文初稿(blockchain + FL)  </li></ul><h3 id="9月"><a href="#9月" class="headerlink" title="9月"></a>9月</h3><ul><li><input checked="" disabled="" type="checkbox"> 论文实验 编码实现FedSharing（Cosmos、p2p）)</li></ul><a id="more"></a><h3 id="10月"><a href="#10月" class="headerlink" title="10月"></a>10月</h3><ul><li><input checked="" disabled="" type="checkbox"> 第一篇投稿</li></ul><h3 id="11月"><a href="#11月" class="headerlink" title="11月"></a>11月</h3><ul><li><input disabled="" type="checkbox"> 实习：1.go云服务、云容器 2.区块链</li><li><input disabled="" type="checkbox"> 项目一：docker从0实现</li><li><input disabled="" type="checkbox"> 项目二：简易Baas平台（Fabric、k8s、go-vue-admin）</li><li><input disabled="" type="checkbox"> 看面经（语言基础）</li><li><input disabled="" type="checkbox"> 刷题（算法基础）</li></ul><h3 id="算法刷题"><a href="#算法刷题" class="headerlink" title="算法刷题"></a>算法刷题</h3><p>剑指offer刷完（47）+ 代码随想录专题（180）+ 老题目（120）$\approx$ 350（230新题 + 120老题）</p><p>11月截止，工作日：60天  =&gt; 一天4道新题 + 2道老题</p><h2 id="今日完成的任务："><a href="#今日完成的任务：" class="headerlink" title="今日完成的任务："></a>今日完成的任务：</h2><ul><li><input checked="" disabled="" type="checkbox"> 投稿论文</li><li><input checked="" disabled="" type="checkbox"> 下午：刷leetcode 3老 + 1新<ul><li>快排✅</li><li>翻转链表✅</li><li>前k个高频元素  ✅</li><li>堆的实现 ✅</li></ul></li><li>LRU缓存机制 ❎</li></ul><h2 id="今日自省"><a href="#今日自省" class="headerlink" title="今日自省"></a>今日自省</h2>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;学习规划&quot;&gt;&lt;a href=&quot;#学习规划&quot; class=&quot;headerlink&quot; title=&quot;学习规划:&quot;&gt;&lt;/a&gt;学习规划:&lt;/h2&gt;&lt;h3 id=&quot;8月&quot;&gt;&lt;a href=&quot;#8月&quot; class=&quot;headerlink&quot; title=&quot;8月&quot;&gt;&lt;/a&gt;8月&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; cosmos项目架构熟悉,&lt;del&gt;做完全部的案例&lt;/del&gt;,&lt;del&gt;并且熟悉SDK&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 科技部编程比赛项目实现(使用cosmos)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; Go公链实现项目(simple_bitcoin)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 专利一篇(金链积分)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 华为区块链比赛&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 第一篇论文初稿(blockchain + FL)  &lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;9月&quot;&gt;&lt;a href=&quot;#9月&quot; class=&quot;headerlink&quot; title=&quot;9月&quot;&gt;&lt;/a&gt;9月&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 论文实验 编码实现FedSharing（Cosmos、p2p）)&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="随笔" scheme="https://xwjahahahaha.github.io/categories/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="每日一记" scheme="https://xwjahahahaha.github.io/categories/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/"/>
    
    
    <category term="每日一记" scheme="https://xwjahahahaha.github.io/tags/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>go项目cli与配置文件：cobra与viper项目</title>
    <link href="https://xwjahahahaha.github.io/2021/10/07/%E6%8A%80%E6%9C%AF%E8%B4%B4/GoLang/%E5%8C%85%E5%AD%A6%E4%B9%A0/go%E9%A1%B9%E7%9B%AEcli%E4%B8%8E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%9Acobra%E4%B8%8Eviper%E9%A1%B9%E7%9B%AE/"/>
    <id>https://xwjahahahaha.github.io/2021/10/07/%E6%8A%80%E6%9C%AF%E8%B4%B4/GoLang/%E5%8C%85%E5%AD%A6%E4%B9%A0/go%E9%A1%B9%E7%9B%AEcli%E4%B8%8E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%9Acobra%E4%B8%8Eviper%E9%A1%B9%E7%9B%AE/</id>
    <published>2021-10-07T11:47:49.000Z</published>
    <updated>2021-10-07T13:33:30.621Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>参考资料：</p><ul><li><p><a href="https://github.com/spf13/cobra" target="_blank" rel="noopener">https://github.com/spf13/cobra</a></p></li><li><p><a href="https://github.com/spf13/viper" target="_blank" rel="noopener">https://github.com/spf13/viper</a></p></li><li><p><a href="https://github.com/spf13/cobra/blob/master/user_guide.md" target="_blank" rel="noopener">https://github.com/spf13/cobra/blob/master/user_guide.md</a></p></li></ul></blockquote><p>作者<a href="https://github.com/spf13" target="_blank" rel="noopener">spf13</a>有两个明星项目—cobra &amp; viper （眼睛蛇与蝮蛇）</p><p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/zTvvSe.png" alt="cobra和viper的代表图案"></p><p>能够帮助我们的go项目添加cmd应用以及读取初始的配置文件，并且两者还可以高效配合使用。</p><p>本文就记录了一下这两个项目的基本使用方式（也是个人使用的记录），方便快速上手，如果想更详细了解的话可以去官网查看详细的文档.</p><a id="more"></a><p>[TOC]</p><h1 id="一、Cobra"><a href="#一、Cobra" class="headerlink" title="一、Cobra"></a>一、Cobra</h1><p>Cobra是一个库，提供了一个简单的界面，可以创建类似于git和go工具的强大的现代CLI界面。  Cobra也是一个应用程序，它可以生成应用程序脚手架来快速开发基于Cobra的应用程序。</p><h2 id="1-1-安装"><a href="#1-1-安装" class="headerlink" title="1.1 安装"></a>1.1 安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/spf13/cobra</span><br></pre></td></tr></table></figure><h2 id="1-2-使用"><a href="#1-2-使用" class="headerlink" title="1.2 使用"></a>1.2 使用</h2><h3 id="1-2-1-架构"><a href="#1-2-1-架构" class="headerlink" title="1.2.1 架构"></a>1.2.1 架构</h3><p>项目一般架构：</p><ul><li>cmd： 目录下存放你的cli各种命令（根命令、子命令等）</li><li>main.go: 项目入口函数</li><li>Init.go: 初始化函数</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">▾ appName/</span><br><span class="line">  ▾ cmd/</span><br><span class="line">      add.go</span><br><span class="line">      your.go</span><br><span class="line">      commands.go</span><br><span class="line">      here.go</span><br><span class="line">      root.go</span><br><span class="line">    main.go</span><br><span class="line">    init.go</span><br></pre></td></tr></table></figure><p><code>root.go</code>编写go项目可执行程序的根命令(以<code>hugo</code>为例)</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rootCmd = &amp;cobra.Command&#123;</span><br><span class="line">  Use:   <span class="string">"hugo"</span>,</span><br><span class="line">  Short: <span class="string">"Hugo is a very fast static site generator"</span>,</span><br><span class="line">  Long: <span class="string">`A Fast and Flexible Static Site Generator built with</span></span><br><span class="line"><span class="string">                love by spf13 and friends in Go.</span></span><br><span class="line"><span class="string">                Complete documentation is available at http://hugo.spf13.com`</span>,</span><br><span class="line">  Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// Do Stuff Here</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Execute</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> err := rootCmd.Execute(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Fprintln(os.Stderr, err)</span><br><span class="line">    os.Exit(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>main.go</code>一般只需要调用根目录的执行函数即可。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"&#123;pathToYourApp&#125;/cmd"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  cmd.Execute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-2-添加子命令"><a href="#1-2-2-添加子命令" class="headerlink" title="1.2.2 添加子命令"></a>1.2.2 添加子命令</h3><p>添加一个子命令<code>add</code>在<code>add.go</code>中：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> add = &amp;cobra.Command&#123;</span><br><span class="line">  Use:   <span class="string">"add [Person]"</span>,</span><br><span class="line">  Short: <span class="string">"add one item"</span>,</span><br><span class="line">  Long:  <span class="string">`add one item`</span>,</span><br><span class="line">  Args: cobra.ExactArgs(<span class="number">1</span>),<span class="comment">// 指定该命令的参数输入个数 </span></span><br><span class="line">  Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span></span> &#123;<span class="comment">// RunE表示可以返回一个错误</span></span><br><span class="line">    <span class="comment">// todo</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一般在在项目的<code>init.go</code>中的<code>init</code>函数中初始化操作：在root命令下添加这个子命令(可以多行添加多个)</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">  cmd.rootCmd.AddCommand(add)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-3-添加flag"><a href="#1-2-3-添加flag" class="headerlink" title="1.2.3 添加flag"></a>1.2.3 添加flag</h3><p>flag有两种类型：</p><ol><li><p>Persistent Flags: 持久型的Flag，即设置在根命令上，其本身以及所有子命令都会有这个全局Flag</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.PersistentFlags().BoolVarP(&amp;Verbose, <span class="string">"verbose"</span>, <span class="string">"v"</span>, <span class="literal">false</span>, <span class="string">"verbose output"</span>)</span><br></pre></td></tr></table></figure></li><li><p>Local Flags: 这种flag只应用在特定的命令上</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localCmd.Flags().StringVarP(&amp;Source, <span class="string">"source"</span>, <span class="string">"s"</span>, <span class="string">""</span>, <span class="string">"Source directory to read from"</span>)</span><br></pre></td></tr></table></figure></li></ol><p>Flag 默认是可选的，但是有的命令我们希望其变为必选，可以这样操作：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Local Flags</span></span><br><span class="line">rootCmd.Flags().StringVarP(&amp;Region, <span class="string">"region"</span>, <span class="string">"r"</span>, <span class="string">""</span>, <span class="string">"AWS region (required)"</span>)</span><br><span class="line">rootCmd.MarkFlagRequired(<span class="string">"region"</span>)</span><br><span class="line"><span class="comment">// Persistent Flags</span></span><br><span class="line">rootCmd.PersistentFlags().StringVarP(&amp;Region, <span class="string">"region"</span>, <span class="string">"r"</span>, <span class="string">""</span>, <span class="string">"AWS region (required)"</span>)</span><br><span class="line">rootCmd.MarkPersistentFlagRequired(<span class="string">"region"</span>)</span><br></pre></td></tr></table></figure><h1 id="二、Viper"><a href="#二、Viper" class="headerlink" title="二、Viper"></a>二、Viper</h1><p>Viper是一个完整的Go应用<strong>配置解决方案</strong>，包括12-Factor应用。它被设计用于在应用程序中工作，可以处理<strong>所有类型</strong>的配置需求和格式。</p><h2 id="2-1-安装"><a href="#2-1-安装" class="headerlink" title="2.1 安装"></a>2.1 安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/spf13/viper</span><br></pre></td></tr></table></figure><h2 id="2-2-使用"><a href="#2-2-使用" class="headerlink" title="2.2 使用"></a>2.2 使用</h2><h3 id="2-2-1-设置默认值"><a href="#2-2-1-设置默认值" class="headerlink" title="2.2.1 设置默认值"></a>2.2.1 设置默认值</h3><p>一个好的项目需要在引入配置文件之前使用一些默认值，可以通过以下方式构建</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viper.SetDefault(<span class="string">"ContentDir"</span>, <span class="string">"content"</span>)</span><br><span class="line">viper.SetDefault(<span class="string">"LayoutDir"</span>, <span class="string">"layouts"</span>)</span><br><span class="line">viper.SetDefault(<span class="string">"Taxonomies"</span>, <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;<span class="string">"tag"</span>: <span class="string">"tags"</span>, <span class="string">"category"</span>: <span class="string">"categories"</span>&#125;)</span><br></pre></td></tr></table></figure><h3 id="2-2-2-读取配置文件"><a href="#2-2-2-读取配置文件" class="headerlink" title="2.2.2 读取配置文件"></a>2.2.2 读取配置文件</h3><p>支持的配置文件格式：<code>JSON, TOML, YAML, HCL, envfile and Java properties config files</code></p><p>Viper可以搜索多个路径，但目前单个Viper实例只支持单个配置文件。</p><p>具体的使用规则如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载配置文件之前，设置一些配置</span></span><br><span class="line">viper.SetConfigName(<span class="string">"config"</span>) <span class="comment">// 配置文件名称</span></span><br><span class="line">viper.SetConfigType(<span class="string">"yaml"</span>) <span class="comment">// 配置文件的拓展名</span></span><br><span class="line">viper.AddConfigPath(<span class="string">"/etc/appname/"</span>)   <span class="comment">// 配置文件的路径</span></span><br><span class="line">viper.AddConfigPath(<span class="string">"$HOME/.appname"</span>)  <span class="comment">// 可设置多个搜索路径</span></span><br><span class="line">viper.AddConfigPath(<span class="string">"."</span>)               <span class="comment">// 可选在当前工作空间中查找</span></span><br><span class="line">err := viper.ReadInConfig() <span class="comment">// 找到并加载配置文件</span></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123; <span class="comment">// 处理错误</span></span><br><span class="line"><span class="built_in">panic</span>(fmt.Errorf(<span class="string">"Fatal error config file: %w \n"</span>, err))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-3-写配置文件"><a href="#2-2-3-写配置文件" class="headerlink" title="2.2.3 写配置文件"></a>2.2.3 写配置文件</h3><p>有时您希望存储在运行时所做的所有修改。为此，可以使用一些命令，每个命令都有自己的用途:</p><ul><li><p>WriteConfig——如果存在，则将当前viper配置写入预定义路径。如果没有预定义的路径，则返回错误。将覆盖当前配置文件，如果它存在。 </p></li><li><p>SafeWriteConfig——将当前的viper配置写入预定义的路径。如果没有预定义的路径，则返回错误。将不会覆盖当前配置文件，如果它存在。</p></li><li><p>WriteConfigAs—将当前viper配置写入给定的文件路径。将覆盖给定的文件，如果它存在。 </p></li><li><p>SafeWriteConfigAs—将当前的viper配置写入给定的文件路径。如果给定的文件存在，则不会覆盖该文件。</p></li></ul><p>所有标记为Safe的函数都不会覆盖任何文件，如果不存在，就创建，而默认行为是创建或截断。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">viper.WriteConfig() <span class="comment">// 将viper中的配置保存到'viper.AddConfigPath()' and 'viper.SetConfigName'预定义的配置文件中</span></span><br><span class="line">viper.SafeWriteConfig()</span><br><span class="line">viper.WriteConfigAs(<span class="string">"/path/to/my/.config"</span>)</span><br><span class="line">viper.SafeWriteConfigAs(<span class="string">"/path/to/my/.config"</span>) <span class="comment">// will error since it has already been written</span></span><br><span class="line">viper.SafeWriteConfigAs(<span class="string">"/path/to/my/.other_config"</span>)</span><br></pre></td></tr></table></figure><h3 id="2-2-4-运行时读取配置文件"><a href="#2-2-4-运行时读取配置文件" class="headerlink" title="2.2.4 运行时读取配置文件"></a>2.2.4 运行时读取配置文件</h3><p>Viper支持让应用程序<strong>在运行时实时读取配置文件的功能</strong>。  需要重新启动服务器以使配置生效的日子已经一去不复返了，使用viper的应用程序可以在运行时读取配置文件的更新，不会错过任何信息。  </p><p>只需告诉viper实例watchConfig。也可以在<strong>每次发生更改</strong>时提供一个函数让Viper运行。</p><p>确保在调用WatchConfig()之前添加了所有的configPaths</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">viper.OnConfigChange(<span class="function"><span class="keyword">func</span><span class="params">(e fsnotify.Event)</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"Config file changed:"</span>, e.Name)</span><br><span class="line">&#125;)</span><br><span class="line">viper.WatchConfig()</span><br></pre></td></tr></table></figure><h3 id="2-2-5-从IO流中读取配置文件"><a href="#2-2-5-从IO流中读取配置文件" class="headerlink" title="2.2.5 从IO流中读取配置文件"></a>2.2.5 从IO流中读取配置文件</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">viper.SetConfigType(<span class="string">"yaml"</span>) <span class="comment">// or viper.SetConfigType("YAML")</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// any approach to require this configuration into your program.</span></span><br><span class="line"><span class="keyword">var</span> yamlExample = []<span class="keyword">byte</span>(<span class="string">`</span></span><br><span class="line"><span class="string">Hacker: true</span></span><br><span class="line"><span class="string">name: steve</span></span><br><span class="line"><span class="string">hobbies:</span></span><br><span class="line"><span class="string">- skateboarding</span></span><br><span class="line"><span class="string">- snowboarding</span></span><br><span class="line"><span class="string">- go</span></span><br><span class="line"><span class="string">clothing:</span></span><br><span class="line"><span class="string">  jacket: leather</span></span><br><span class="line"><span class="string">  trousers: denim</span></span><br><span class="line"><span class="string">age: 35</span></span><br><span class="line"><span class="string">eyes : brown</span></span><br><span class="line"><span class="string">beard: true</span></span><br><span class="line"><span class="string">`</span>)</span><br><span class="line"></span><br><span class="line">viper.ReadConfig(bytes.NewBuffer(yamlExample))</span><br><span class="line"></span><br><span class="line">viper.Get(<span class="string">"name"</span>) <span class="comment">// this would be "steve"</span></span><br></pre></td></tr></table></figure><h3 id="2-2-6-重设值与覆盖、键使用别名"><a href="#2-2-6-重设值与覆盖、键使用别名" class="headerlink" title="2.2.6 重设值与覆盖、键使用别名"></a>2.2.6 重设值与覆盖、键使用别名</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">viper.Set(<span class="string">"Verbose"</span>, <span class="literal">true</span>)</span><br><span class="line">viper.Set(<span class="string">"LogFile"</span>, LogFile)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册</span></span><br><span class="line">viper.RegisterAlias(<span class="string">"loud"</span>, <span class="string">"Verbose"</span>)</span><br><span class="line"></span><br><span class="line">viper.Set(<span class="string">"verbose"</span>, <span class="literal">true</span>) <span class="comment">// same result as next line</span></span><br><span class="line">viper.Set(<span class="string">"loud"</span>, <span class="literal">true</span>)   <span class="comment">// same result as prior line</span></span><br><span class="line"></span><br><span class="line">viper.GetBool(<span class="string">"loud"</span>) <span class="comment">// true</span></span><br><span class="line">viper.GetBool(<span class="string">"verbose"</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="2-2-7-Get值"><a href="#2-2-7-Get值" class="headerlink" title="2.2.7 Get值"></a>2.2.7 Get值</h3><p>Viper提供的所有Get值的方法：</p><ul><li><code>Get(key string) : interface{}</code></li><li><code>GetBool(key string) : bool</code></li><li><code>GetFloat64(key string) : float64</code></li><li><code>GetInt(key string) : int</code></li><li><code>GetIntSlice(key string) : []int</code></li><li><code>GetString(key string) : string</code></li><li><code>GetStringMap(key string) : map[string]interface{}</code></li><li><code>GetStringMapString(key string) : map[string]string</code></li><li><code>GetStringSlice(key string) : []string</code></li><li><code>GetTime(key string) : time.Time</code></li><li><code>GetDuration(key string) : time.Duration</code></li><li><code>IsSet(key string) : bool</code></li><li><code>AllSettings() : map[string]interface{}</code></li></ul><p>需要注意的一件重要的事情是，如果没有找到，每个Get函数将返回一个零值。为了检查给定的键是否存在，提供了IsSet()方法。</p><p>获取多重嵌套的Key、数组：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"host"</span>: &#123;</span><br><span class="line">        <span class="attr">"address"</span>: <span class="string">"localhost"</span>,</span><br><span class="line">        <span class="attr">"ports"</span>: [</span><br><span class="line">            <span class="number">5799</span>,</span><br><span class="line">            <span class="number">6029</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"datastore"</span>: &#123;</span><br><span class="line">        <span class="attr">"metric"</span>: &#123;</span><br><span class="line">            <span class="attr">"host"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">3099</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"warehouse"</span>: &#123;</span><br><span class="line">            <span class="attr">"host"</span>: <span class="string">"198.0.0.1"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">2112</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GetInt("host.ports.1") // returns 6029</span><br></pre></td></tr></table></figure><blockquote><p><font color='#39b54a'>注意： 如果有与上述方法中<code>.</code>取健相同，那么就使用该健</font></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"datastore.metric.host"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">    <span class="string">"host"</span>: &#123;</span><br><span class="line">        <span class="string">"address"</span>: <span class="string">"localhost"</span>,</span><br><span class="line">        <span class="string">"port"</span>: <span class="number">5799</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"datastore"</span>: &#123;</span><br><span class="line">        <span class="string">"metric"</span>: &#123;</span><br><span class="line">            <span class="string">"host"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">            <span class="string">"port"</span>: <span class="number">3099</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"warehouse"</span>: &#123;</span><br><span class="line">            <span class="string">"host"</span>: <span class="string">"198.0.0.1"</span>,</span><br><span class="line">            <span class="string">"port"</span>: <span class="number">2112</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GetString(<span class="string">"datastore.metric.host"</span>) <span class="comment">// returns "0.0.0.0"</span></span><br></pre></td></tr></table></figure></blockquote><p>viper还支持远程在key/value数据库中读取配置，还可以读取环境变量等等高级功能，如果有需求的话可以看官方文档。</p><h1 id="三、结合使用"><a href="#三、结合使用" class="headerlink" title="三、结合使用"></a>三、结合使用</h1><p>结合使用其实也就是通过viper读取配置文件，然后给cobra的flag使用</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">serverCmd.Flags().Int(<span class="string">"port"</span>, <span class="number">1138</span>, <span class="string">"Port to run Application server on"</span>)</span><br><span class="line">viper.BindPFlag(<span class="string">"port"</span>, serverCmd.Flags().Lookup(<span class="string">"port"</span>))</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;参考资料：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/spf13/cobra&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/spf13/cobra&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/spf13/viper&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/spf13/viper&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/spf13/cobra/blob/master/user_guide.md&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/spf13/cobra/blob/master/user_guide.md&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;作者&lt;a href=&quot;https://github.com/spf13&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;spf13&lt;/a&gt;有两个明星项目—cobra &amp;amp; viper （眼睛蛇与蝮蛇）&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://xwjpics.gumptlu.work/qinniu_uPic/zTvvSe.png&quot; alt=&quot;cobra和viper的代表图案&quot;&gt;&lt;/p&gt;
&lt;p&gt;能够帮助我们的go项目添加cmd应用以及读取初始的配置文件，并且两者还可以高效配合使用。&lt;/p&gt;
&lt;p&gt;本文就记录了一下这两个项目的基本使用方式（也是个人使用的记录），方便快速上手，如果想更详细了解的话可以去官网查看详细的文档.&lt;/p&gt;</summary>
    
    
    
    <category term="technical" scheme="https://xwjahahahaha.github.io/categories/technical/"/>
    
    
    <category term="golang" scheme="https://xwjahahahaha.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>go调用python3:go-python3包的使用</title>
    <link href="https://xwjahahahaha.github.io/2021/10/06/%E6%8A%80%E6%9C%AF%E8%B4%B4/GoLang/%E5%8C%85%E5%AD%A6%E4%B9%A0/go%E8%B0%83%E7%94%A8python3-go-python3%E5%8C%85%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>https://xwjahahahaha.github.io/2021/10/06/%E6%8A%80%E6%9C%AF%E8%B4%B4/GoLang/%E5%8C%85%E5%AD%A6%E4%B9%A0/go%E8%B0%83%E7%94%A8python3-go-python3%E5%8C%85%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2021-10-06T08:00:32.000Z</published>
    <updated>2021-10-11T07:22:42.084Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>参考资料：</p><p><a href="https://zhuanlan.zhihu.com/p/150253406" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/150253406</a></p><p><a href="https://blog.csdn.net/skyztttt/article/details/8115086" target="_blank" rel="noopener">https://blog.csdn.net/skyztttt/article/details/8115086</a></p><p><a href="https://poweruser.blog/embedding-python-in-go-338c0399f3d5" target="_blank" rel="noopener">https://poweruser.blog/embedding-python-in-go-338c0399f3d5</a></p><p>包地址：</p><p>python2：<a href="https://github.com/sbinet/go-python" target="_blank" rel="noopener">https://github.com/sbinet/go-python</a></p><p>python3：<a href="https://github.com/DataDog/go-python3" target="_blank" rel="noopener">https://github.com/DataDog/go-python3</a></p></blockquote><a id="more"></a><p>Python是机器/深度学习御用开发语言，Golang是新时代后端开发语言。Python很适合算法写模型，而Golang很适合提供API服务，两位同志都红的发紫。</p><p>出于项目需求和兴趣，这里就介绍一下正确搅基的办法。</p><p>从网络中查询资料后，发现两个好用的包（见上方）</p><p><strong>因为python使用的是3.x，所以本文使用的是DataDog/go-python3版本， sbinet/go-python对应python2.x</strong></p><p>[TOC]</p><h1 id="一、安装go-python3包"><a href="#一、安装go-python3包" class="headerlink" title="一、安装go-python3包"></a>一、安装go-python3包</h1><p>安装就有点麻烦。。。</p><blockquote><p>我的环境</p><p>系统：MacOS Big Sur 11.6 M1芯片 arm64</p><p>go：go version go1.16.5 darwin/arm64</p><p>python：python3.9</p></blockquote><p>命令: <code>go get github.com/DataDog/go-python3</code></p><p>报错1:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> github.com/DataDog/go-python3</span></span><br><span class="line">../../../go_projects/pkg/mod/github.com/!data!dog/go-python3@v0.0.0-20210805105248-03d93fb21b67/dict.go:141:13: could not determine kind of name for C.PyDict_ClearFreeList</span><br></pre></td></tr></table></figure><p>原因：</p><p><strong><code>DataDog/go-python3</code>只适用于<code>python3.7</code>版本！</strong>，所以之前我的电脑安装的是3.9，3.9版本删除了<code>C.PyDict_ClearFreeList</code>函数，所以找不到。</p><p>（The C.PyDict_ClearFreeList function <a href="https://docs.python.domainunion.de/3/whatsnew/3.9.html#id3" target="_blank" rel="noopener">has been removed</a> from the Python C API with Python 3.9)</p><p><a href="https://github.com/DataDog/go-python3/issues/38" target="_blank" rel="noopener">https://github.com/DataDog/go-python3/issues/38</a></p><p>解决：</p><p>使用<code>anaconda</code>创建一个python3.7的环境：（如果不会使用<code>anaconda</code>可以自行百度，不难）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda create -n fs_py37 python=3.7</span><br><span class="line">conda activate fs_py37</span><br></pre></td></tr></table></figure><p>找到环境下<code>lib/pkgconfig</code>目录, 我的是：(一般都在conda安装中的envs下)</p><p><code>/Users/xwj/opt/anaconda3/envs/fs_py37/lib/pkgconfig</code></p><p>然后重置环境, go get:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export PKG_CONFIG_PATH=/Users/xwj/opt/anaconda3/envs/fs_py37/lib/pkgconfig</span><br><span class="line">go get github.com/DataDog/go-python3</span><br></pre></td></tr></table></figure><p>报错2（不是m1 mac的可能没问题）:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> github.com/DataDog/go-python3</span></span><br><span class="line">ld: warning: ignoring file /Users/xwj/opt/anaconda3/envs/fs_py37/lib/libpython3.7m.dylib, building for macOS-arm64 but attempting to link with file built for macOS-x86_64</span><br><span class="line">Undefined symbols for architecture arm64:</span><br><span class="line">  "_PyBool_FromLong", referenced from:</span><br><span class="line">      __cgo_a0c8609171f9_Cfunc_PyBool_FromLong in _x002.o</span><br><span class="line">     (maybe you meant: __cgo_a0c8609171f9_Cfunc_PyBool_FromLong)</span><br><span class="line">.....</span><br></pre></td></tr></table></figure><p>原因：</p><p>anaconda安装的python3.7版本（amd64）与go的arm64架构不匹配（垃圾M1）</p><p>解决：</p><p>要么换python架构，要么换go的架构，反正两者架构要一致才可以</p><p>尴尬的是，目前M1还是不支持<a href="mailto:python@3.7">python@3.7</a>: <a href="https://doesitarm.com/formula/python@3.7/" target="_blank" rel="noopener">https://doesitarm.com/formula/python@3.7/</a></p><p>所以只能安装一个go的amd64版本也就是intel的x86 (以后也可能用得到)：</p><ol><li><p>官网下载压缩包：<a href="https://golang.google.cn/dl/" target="_blank" rel="noopener">https://golang.google.cn/dl/</a></p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/QvtNdL.png" alt="QvtNdL" style="zoom:67%;" /><p>注意选x86架构而不是ARM64</p></li><li><p>将解压的文件夹放到一个你喜欢的地方，我是<code>/Users/xwj/sdk/go_x86_1.17.1</code></p></li><li><p>进入这个文件夹修改<code>go</code>执行文件名字，防止和本来的arm架构的<code>go</code>重名，并且提醒自己使用的go环境</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd go_x86_1.17.1/bin</span><br><span class="line">mv go gox86</span><br></pre></td></tr></table></figure></li><li><p>添加配置文件：</p><p><code>vim ~/.zshrc</code>，我的配置文件如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Go arm64</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">export</span> GOROOT=<span class="string">"/Users/xwj/sdk/go1.17.1"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Go x86-64</span></span><br><span class="line">export GOROOT="/Users/xwj/sdk/go_x86_1.17.1"</span><br><span class="line">export GOPROXY=https://goproxy.cn,direct</span><br><span class="line">export GOPATH="/Users/xwj/projects/go_projects"</span><br><span class="line">export GO111MODULE="auto"</span><br><span class="line">export PATH=$PATH:$GOROOT/bin:$GOPATH/src:$GOPATH/bin</span><br></pre></td></tr></table></figure><p><code>source ~/.zshrc</code>, 重新打开一个终端</p><p><strong>想使用哪个就将另一个注释掉再source一下即可（重开终端）</strong></p></li><li><p>测试：</p><p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/image-20211006170400449.png" alt="image-20211006170400449"></p><p>这样go环境就可以切换了，目前先使用amd64的尝试</p></li></ol><p>下面再重新get测试一下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export PKG_CONFIG_PATH=/Users/xwj/opt/anaconda3/envs/fs_py37/lib/pkgconfig</span><br><span class="line">gox86 get github.com/datadog/go-python3</span><br></pre></td></tr></table></figure><p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/6561pH.png" alt="6561pH"></p><p>大功告成！</p><h1 id="二、基本使用"><a href="#二、基本使用" class="headerlink" title="二、基本使用"></a>二、基本使用</h1><h2 id="2-1-调用自定义python"><a href="#2-1-调用自定义python" class="headerlink" title="2.1 调用自定义python"></a>2.1 调用自定义python</h2><p>目录总体结构：</p><p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/image-20211006213827430.png" alt="image-20211006213827430"></p><p>测试的python文件</p><p><code>hello.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">10</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">SayHello</span><span class="params">(xixi)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> xixi + <span class="string">"haha"</span></span><br></pre></td></tr></table></figure><p>可以将go调用python的过程分为以下5步：</p><ol><li><p>初始化python环境</p></li><li><p>引入模块py对象</p></li><li><p>使用该模块的变量与函数</p></li><li><p>解析结果</p></li><li><p>销毁python3运行环境</p></li></ol><p>以下五步的所有程序都在<code>main.go</code>文件中</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"github.com/datadog/go-python3"</span></span><br><span class="line"><span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// 1. 初始化python环境</span></span><br><span class="line">python3.Py_Initialize()</span><br><span class="line"><span class="keyword">if</span> !python3.Py_IsInitialized() &#123;</span><br><span class="line">fmt.Println(<span class="string">"Error initializing the python interpreter"</span>)</span><br><span class="line">os.Exit(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// 2. 设置本地python import 的路径</span></span><br><span class="line">p := <span class="string">"/Users/xwj/opt/anaconda3/envs/fs_py37/lib/python3.7/site-packages"</span></span><br><span class="line">InsertBeforeSysPath(p)</span><br><span class="line"><span class="comment">// 3. 导入hello模块</span></span><br><span class="line">hello := ImportModule(<span class="string">"./hello"</span>, <span class="string">"hello"</span>)</span><br><span class="line"><span class="comment">// pyObject =&gt; string 解析结果</span></span><br><span class="line">helloRepr, err := pythonRepr(hello)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">"[MODULE] repr(hello) = %s\n"</span>, helloRepr)</span><br><span class="line"><span class="comment">// 4. 获取变量</span></span><br><span class="line">a := hello.GetAttrString(<span class="string">"a"</span>)</span><br><span class="line">aString, err := pythonRepr(a)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">"[VARS] a = %#v\n"</span>, aString)</span><br><span class="line"><span class="comment">// 5. 获取函数方法</span></span><br><span class="line">SayHello := hello.GetAttrString(<span class="string">"SayHello"</span>)</span><br><span class="line"><span class="comment">// 设置调用的参数（一个元组）</span></span><br><span class="line">args := python3.PyTuple_New(<span class="number">1</span>)<span class="comment">// 创建存储空间</span></span><br><span class="line">python3.PyTuple_SetItem(args, <span class="number">0</span>, python3.PyUnicode_FromString(<span class="string">"xwj"</span>))<span class="comment">// 设置值</span></span><br><span class="line">res := SayHello.Call(args, python3.Py_None)<span class="comment">// 调用</span></span><br><span class="line">fmt.Printf(<span class="string">"[FUNC] res = %s\n"</span>, python3.PyUnicode_AsUTF8(res))</span><br><span class="line"><span class="comment">// 6. 调用第三方库sklearn</span></span><br><span class="line">sklearn := hello.GetAttrString(<span class="string">"sklearn"</span>)</span><br><span class="line">skVersion := sklearn.GetAttrString(<span class="string">"__version__"</span>)</span><br><span class="line">sklearnRepr, err := pythonRepr(sklearn)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">skVersionRepr, err := pythonRepr(skVersion)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">"[IMPORT] sklearn = %s\n"</span>, sklearnRepr)</span><br><span class="line">fmt.Printf(<span class="string">"[IMPORT] sklearn version =  %s\n"</span>, skVersionRepr)</span><br><span class="line"><span class="comment">//// 7. 结束环境</span></span><br><span class="line">python3.Py_Finalize()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// InsertBeforeSysPath</span></span><br><span class="line"><span class="comment">// @Description: 添加site-packages路径即包的查找路径</span></span><br><span class="line"><span class="comment">// @param p</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InsertBeforeSysPath</span><span class="params">(p <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">sysModule := python3.PyImport_ImportModule(<span class="string">"sys"</span>)</span><br><span class="line">path := sysModule.GetAttrString(<span class="string">"path"</span>)</span><br><span class="line">python3.PyList_Append(path, python3.PyUnicode_FromString(p))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ImportModule</span></span><br><span class="line"><span class="comment">// @Description: 倒入一个包</span></span><br><span class="line"><span class="comment">// @param dir</span></span><br><span class="line"><span class="comment">// @param name</span></span><br><span class="line"><span class="comment">// @return *python3.PyObject</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ImportModule</span><span class="params">(dir, name <span class="keyword">string</span>)</span> *<span class="title">python3</span>.<span class="title">PyObject</span></span> &#123;</span><br><span class="line">sysModule := python3.PyImport_ImportModule(<span class="string">"sys"</span>) <span class="comment">// import sys</span></span><br><span class="line">path := sysModule.GetAttrString(<span class="string">"path"</span>)            <span class="comment">// path = sys.path</span></span><br><span class="line">python3.PyList_Insert(path, <span class="number">0</span>, python3.PyUnicode_FromString(dir)) <span class="comment">// path.insert(0, dir)</span></span><br><span class="line"><span class="keyword">return</span> python3.PyImport_ImportModule(name)            <span class="comment">// return __import__(name)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// pythonRepr</span></span><br><span class="line"><span class="comment">// @Description: PyObject转换为string</span></span><br><span class="line"><span class="comment">// @param o</span></span><br><span class="line"><span class="comment">// @return string</span></span><br><span class="line"><span class="comment">// @return error</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pythonRepr</span><span class="params">(o *python3.PyObject)</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> o == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">""</span>, fmt.Errorf(<span class="string">"object is nil"</span>)</span><br><span class="line">&#125;</span><br><span class="line">s := o.Repr()</span><br><span class="line"><span class="keyword">if</span> s == <span class="literal">nil</span> &#123;</span><br><span class="line">python3.PyErr_Clear()</span><br><span class="line"><span class="keyword">return</span> <span class="string">""</span>, fmt.Errorf(<span class="string">"failed to call Repr object method"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> s.DecRef()</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> python3.PyUnicode_AsUTF8(s), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PrintList</span></span><br><span class="line"><span class="comment">// @Description: 输出一个List</span></span><br><span class="line"><span class="comment">// @param list</span></span><br><span class="line"><span class="comment">// @return error</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PrintList</span><span class="params">(list *python3.PyObject)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> exc := python3.PyErr_Occurred(); list == <span class="literal">nil</span> &amp;&amp; exc != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"Fail to create python list object"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> list.DecRef()</span><br><span class="line">repr, err := pythonRepr(list)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"fail to get representation of object list"</span>)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">"python list: %s\n"</span>, repr)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译成可执行文件<code>test</code>并运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gox86 build ./</span><br><span class="line">./test</span><br></pre></td></tr></table></figure><p>运行时报错：<code>dyld: Library not loaded: @rpath/libpython3.7m.dylib</code></p><p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/UFgcZm.png" alt="UFgcZm"></p><p>原因：</p><p>该运行文件没有链接到需要匹配的python lib库</p><p>解决：</p><p>首先查看该文件的依赖文件：</p><p><code>otool -L /Users/xwj/projects/blockchain_projects/FedSharing/fed_sharing/mainchain/miner/test/./test</code></p><p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/mYYj86.png" alt="mYYj86"></p><p>可以看到有两个依赖，第一个无法加载，可能就是路径有问题</p><p>在此之前，我们可以简单了解一下<code>@executable_path、@loader_path、@rpath</code>三者都是什么意思：</p><ul><li>@executable_path：就是可执行程序的路径</li><li>@loader_path：可以通过这个path来设置动态库的install path name</li><li>@rpath：它是run path的缩写。本质上它不是一个明确的path，甚至可以说它不是一个path。它只是一个变量，或者叫<strong>占位符</strong>。这个变量通过XCode中的run path选项设置值，或者通过<code>install_name_tool</code>的<code>-add_rpath</code>设置值。设置好run path之后，所有的@rpath都会被替换掉</li></ul><p>我们并没有设置@rpath，所以导致失败。</p><p>所以在这里我们给其设置一个@rpath即之前本地conda创建的库，这样就可以链接上了。</p><p>找到库的路径，我的是<code>/Users/xwj/opt/anaconda3/envs/fs_py37/lib/libpython3.7m.dylib</code> (就是在你创建的环境名下的lib中)</p><p>然后对这个可执行文件<code>test</code>运行以下命令添加：</p><p><code>install_name_tool -add_rpath /Users/xwj/opt/anaconda3/envs/fs_py37/lib ./test</code></p><blockquote><p><font color='#39b54a'>如果你的可执行程序希望在多个机器上都适配，那么可以添加一个链接，把lib放到项目相对路径下，使用@executable_path指向这个相对路径</font></p></blockquote><p>再次运行即可</p><p>输出如下：</p><p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/image-20211006215622130.png" alt="image-20211006215622130"></p><h2 id="2-2-调用import的第三方库包"><a href="#2-2-调用import的第三方库包" class="headerlink" title="2.2 调用import的第三方库包"></a>2.2 调用import的第三方库包</h2><p>这里以<code>sklearn</code>为例</p><p>在hello.py中添加<code>import sklearn</code></p><p>在conda环境下下载：<code>conda install scikit-learn -y</code></p><p>如果使用IDE记得将IDE中python环境设置与conda activate的环境一致</p><p>在<code>main.go</code>中添加:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// 6. 调用第三方库sklearn</span></span><br><span class="line">sklearn := hello.GetAttrString(<span class="string">"sklearn"</span>)</span><br><span class="line">skVersion := sklearn.GetAttrString(<span class="string">"__version__"</span>)</span><br><span class="line">sklearnRepr, err := pythonRepr(sklearn)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">skVersionRepr, err := pythonRepr(skVersion)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">"[IMPORT] sklearn = %s\n"</span>, sklearnRepr)</span><br><span class="line">fmt.Printf(<span class="string">"[IMPORT] sklearn version =  %s\n"</span>, skVersionRepr)</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果如下：</p><p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/image-20211006230529317.png" alt="image-20211006230529317"></p><p>基本的使用可以了之后就可以自由的使用go去调用python函数了，还有更多的功能（例如设置python变量的值等）都可以在<a href="https://docs.python.org/3.7/c-api/index.html查看！" target="_blank" rel="noopener">https://docs.python.org/3.7/c-api/index.html查看！</a></p><h1 id="三、内存管理"><a href="#三、内存管理" class="headerlink" title="三、内存管理"></a>三、内存管理</h1><p>虽然go和python都是自动管理内存的，但是当我们使用<code>PyObject</code>的时候我们需要手动提示Python runtime该<code>PyObject</code>是否还需要，否则就可能发生内存的泄漏。</p><p>每个<code>PyObject</code>都有一个引用计数，如果它降为0,Python的垃圾收集器知道它可以释放内存。</p><p>当我们不再需要一个对象时，有时我们需要减少<code>ref count</code>，有时我们需要增加它，以确保内存不会被过快释放。</p><p>每一个<code>PyObject</code>都有两个函数:</p><ul><li><code>.DecRef()</code>: 减少引用计数</li><li><code>.IncRef()</code>: 增加引用计数</li></ul><p>当我们调用Python C API函数时，输入和返回的<code>PyObjects</code>会发生以下三种已定义的情况:</p><ol><li><p>Return value: “New” reference</p><p>大多数在当我们创建一个新的Obecjt的时候(i.e. <code>PyList_new</code>)</p><p>一旦你不再需要<code>PyObject</code>，你可以<strong>减少</strong>引用计数<code>.DecRef()</code>，或者把它交给需要的人(例如，另一个使用它的函数，或者把它作为返回值传递给调用者，然后减值)。否则就会出现内存泄漏。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pObject := python3.PyUnicode_FromString(p)</span><br><span class="line"><span class="keyword">defer</span> pObject.DecRef()</span><br></pre></td></tr></table></figure></li><li><p>The function “steals” a reference to an item</p><p>大多数在函数设置set items的时候，例如<code>PyList_setItem</code>, 这时候我们不需要做任何事</p></li><li><p>Return value: “Borrowed” reference</p><p>两个指针指向同一个内存空间</p><p>大多数函数get items的时候，例如<code>PyList_GetItem</code></p><p>如果你想继续处理这个对象/指针，就<strong>增加</strong>引用计数(并注意以后它会以某种方式减少)。</p></li></ol><p>例子：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pylist := python3.PyList_New(<span class="built_in">len</span>(data)) <span class="comment">//retval: New reference, gets stolen later</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(data); i++ &#123;</span><br><span class="line">  item := python3.PyFloat_FromDouble(data[i]) <span class="comment">//ret val: New reference, gets stolen later</span></span><br><span class="line">  ret := python3.PyList_SetItem(pylist, i, item)</span><br><span class="line">  <span class="keyword">if</span> ret != <span class="number">0</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> python3.PyErr_Occurred() != <span class="literal">nil</span> &#123;</span><br><span class="line">      python3.PyErr_Print()</span><br><span class="line">    &#125;</span><br><span class="line">    item.DecRef()</span><br><span class="line">    pylist.DecRef()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"error setting list item"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当我们心创建一个<code>PyObject</code>时因为后续还要使用(<code>stolen</code>加入到List中)，所以我们先不<code>.DecRef()</code>，当<code>pylist.DecRef()</code>的时候会把其中所有的元素都一起<code>.DecRef()</code></p><p>现在我们需要修改之前的<code>main.go</code>代码，防止内存的泄漏：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"github.com/datadog/go-python3"</span></span><br><span class="line"><span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// 1. 初始化python环境</span></span><br><span class="line">python3.Py_Initialize()</span><br><span class="line"><span class="keyword">if</span> !python3.Py_IsInitialized() &#123;</span><br><span class="line">fmt.Println(<span class="string">"Error initializing the python interpreter"</span>)</span><br><span class="line">os.Exit(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// 7. 结束环境(提前defer)</span></span><br><span class="line"><span class="keyword">defer</span> python3.Py_Finalize()</span><br><span class="line"><span class="comment">// 2. 设置python import 的路径</span></span><br><span class="line">p := <span class="string">"/Users/xwj/opt/anaconda3/envs/fs_py37/lib/python3.7/site-packages"</span></span><br><span class="line">InsertBeforeSysPath(p)</span><br><span class="line"><span class="comment">// 3. 导入hello模块</span></span><br><span class="line">hello := ImportModule(<span class="string">"./hello"</span>, <span class="string">"hello"</span>)</span><br><span class="line"><span class="keyword">defer</span> hello.DecRef()</span><br><span class="line"><span class="comment">// pyObject =&gt; string 解析结果</span></span><br><span class="line">helloRepr, err := pythonRepr(hello)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">"[MODULE] repr(hello) = %s\n"</span>, helloRepr)</span><br><span class="line"><span class="comment">// 4. 获取变量</span></span><br><span class="line">a := hello.GetAttrString(<span class="string">"a"</span>)</span><br><span class="line"><span class="keyword">defer</span> a.DecRef()</span><br><span class="line">aString, err := pythonRepr(a)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">"[VARS] a = %#v\n"</span>, aString)</span><br><span class="line"><span class="comment">// 5. 获取函数方法</span></span><br><span class="line">SayHello := hello.GetAttrString(<span class="string">"SayHello"</span>)</span><br><span class="line"><span class="keyword">defer</span> SayHello.DecRef()</span><br><span class="line"><span class="comment">// 设置调用的参数（一个元组）</span></span><br><span class="line">args := python3.PyTuple_New(<span class="number">1</span>)<span class="comment">// 创建存储空间</span></span><br><span class="line"><span class="keyword">defer</span> args.DecRef()</span><br><span class="line">input := python3.PyUnicode_FromString(<span class="string">"xwj"</span>)<span class="comment">// input不需要DecRef，因为DecRef args的时候就一起DecRef了</span></span><br><span class="line">python3.PyTuple_SetItem(args, <span class="number">0</span>, input)<span class="comment">// 设置值</span></span><br><span class="line">res := SayHello.Call(args, python3.Py_None)<span class="comment">// 调用</span></span><br><span class="line">fmt.Printf(<span class="string">"[FUNC] res = %s\n"</span>, python3.PyUnicode_AsUTF8(res))</span><br><span class="line"><span class="comment">// 6. 调用第三方库sklearn</span></span><br><span class="line">sklearn := hello.GetAttrString(<span class="string">"sklearn"</span>)</span><br><span class="line"><span class="keyword">defer</span> sklearn.DecRef()</span><br><span class="line">skVersion := sklearn.GetAttrString(<span class="string">"__version__"</span>)</span><br><span class="line"><span class="keyword">defer</span> skVersion.DecRef()</span><br><span class="line">sklearnRepr, err := pythonRepr(sklearn)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">skVersionRepr, err := pythonRepr(skVersion)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">"[IMPORT] sklearn = %s\n"</span>, sklearnRepr)</span><br><span class="line">fmt.Printf(<span class="string">"[IMPORT] sklearn version =  %s\n"</span>, skVersionRepr)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// InsertBeforeSysPath</span></span><br><span class="line"><span class="comment">// @Description: 添加site-packages路径即包的查找路径</span></span><br><span class="line"><span class="comment">// @param p</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InsertBeforeSysPath</span><span class="params">(p <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">sysModule := python3.PyImport_ImportModule(<span class="string">"sys"</span>)</span><br><span class="line">path := sysModule.GetAttrString(<span class="string">"path"</span>)</span><br><span class="line">pObject := python3.PyUnicode_FromString(p)</span><br><span class="line"><span class="keyword">defer</span> pObject.DecRef()</span><br><span class="line">python3.PyList_Append(path, pObject)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ImportModule</span></span><br><span class="line"><span class="comment">// @Description: 倒入一个包</span></span><br><span class="line"><span class="comment">// @param dir</span></span><br><span class="line"><span class="comment">// @param name</span></span><br><span class="line"><span class="comment">// @return *python3.PyObject</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ImportModule</span><span class="params">(dir, name <span class="keyword">string</span>)</span> *<span class="title">python3</span>.<span class="title">PyObject</span></span> &#123;</span><br><span class="line">sysModule := python3.PyImport_ImportModule(<span class="string">"sys"</span>) <span class="comment">// import sys</span></span><br><span class="line">path := sysModule.GetAttrString(<span class="string">"path"</span>)            <span class="comment">// path = sys.path</span></span><br><span class="line">dirObject := python3.PyUnicode_FromString(dir)</span><br><span class="line"><span class="keyword">defer</span> dirObject.DecRef()</span><br><span class="line">python3.PyList_Insert(path, <span class="number">0</span>, dirObject) <span class="comment">// path.insert(0, dir)</span></span><br><span class="line"><span class="keyword">return</span> python3.PyImport_ImportModule(name)            <span class="comment">// return __import__(name)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// pythonRepr</span></span><br><span class="line"><span class="comment">// @Description: PyObject转换为string</span></span><br><span class="line"><span class="comment">// @param o</span></span><br><span class="line"><span class="comment">// @return string</span></span><br><span class="line"><span class="comment">// @return error</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pythonRepr</span><span class="params">(o *python3.PyObject)</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> o == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">""</span>, fmt.Errorf(<span class="string">"object is nil"</span>)</span><br><span class="line">&#125;</span><br><span class="line">s := o.Repr()<span class="comment">// 获取对象转换为可读</span></span><br><span class="line"><span class="keyword">if</span> s == <span class="literal">nil</span> &#123;</span><br><span class="line">python3.PyErr_Clear()</span><br><span class="line"><span class="keyword">return</span> <span class="string">""</span>, fmt.Errorf(<span class="string">"failed to call Repr object method"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> s.DecRef()</span><br><span class="line"><span class="keyword">return</span> python3.PyUnicode_AsUTF8(s), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PrintList</span></span><br><span class="line"><span class="comment">// @Description: 输出一个List</span></span><br><span class="line"><span class="comment">// @param list</span></span><br><span class="line"><span class="comment">// @return error</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PrintList</span><span class="params">(list *python3.PyObject)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> exc := python3.PyErr_Occurred(); list == <span class="literal">nil</span> &amp;&amp; exc != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"Fail to create python list object"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> list.DecRef()</span><br><span class="line">repr, err := pythonRepr(list)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"fail to get representation of object list"</span>)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">"python list: %s\n"</span>, repr)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="四、Pylist迭代器"><a href="#四、Pylist迭代器" class="headerlink" title="四、Pylist迭代器"></a>四、Pylist迭代器</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pylist := python3.PyList_New(<span class="built_in">len</span>(data)) <span class="comment">//retval: New reference, gets stolen later</span></span><br><span class="line"><span class="keyword">defer</span> pylist.DecRef()</span><br><span class="line"><span class="comment">// 获取迭代器</span></span><br><span class="line">seq := pylist.GetIter() <span class="comment">//ret val: New reference</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">defer</span> seq.DecRef()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 迭代器有next函数，能够返回下一个item</span></span><br><span class="line">tNext := seq.GetAttrString(<span class="string">"__next__"</span>) <span class="comment">//ret val: new ref</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">defer</span> tNext.DecRef()</span><br><span class="line"></span><br><span class="line">pylistLen := pylist.Length()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= pylistLen; i++ &#123;</span><br><span class="line">  item := tNext.CallObject(<span class="literal">nil</span>) <span class="comment">//ret val: new ref</span></span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">  <span class="keyword">if</span> item != <span class="literal">nil</span> &#123;</span><br><span class="line">    item.DecRef()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="五、多个goroutine调用python"><a href="#五、多个goroutine调用python" class="headerlink" title="五、多个goroutine调用python"></a>五、多个goroutine调用python</h1><p>要点： <strong>保证python在一段时间中只给一个线程调用</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># foo.py</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_odds</span><span class="params">(limit=<span class="number">10</span>)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Print odds numbers &lt; limit</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(limit):</span><br><span class="line">        <span class="keyword">if</span> i%<span class="number">2</span>:</span><br><span class="line">            sys.stderr.write(<span class="string">"&#123;&#125;\n"</span>.format(i))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_even</span><span class="params">(limit=<span class="number">10</span>)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Print even numbers &lt; limit</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(limit):</span><br><span class="line">        <span class="keyword">if</span> i%<span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            sys.stderr.write(<span class="string">"&#123;&#125;\n"</span>.format(i))</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// We’ll try to print odd and even numbers concurrently from Go, using two different goroutines (thus involving threads):</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"sync"</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"github.com/sbinet/go-python"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// PyEval_InitThreads() 创建全局解释器GIL并且会锁定他</span></span><br><span class="line">    python.Initialize()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">    wg.Add(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    fooModule := python.PyImport_ImportModule(<span class="string">"foo"</span>)</span><br><span class="line">    odds := fooModule.GetAttrString(<span class="string">"print_odds"</span>)</span><br><span class="line">    even := fooModule.GetAttrString(<span class="string">"print_even"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存当前锁定的状态，然后释放GIL锁</span></span><br><span class="line">    state := python.PyEval_SaveThread()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="comment">// 获取当前的GIL并锁定</span></span><br><span class="line">        _gstate := python.PyGILState_Ensure()</span><br><span class="line">        odds.Call(python.PyTuple_New(<span class="number">0</span>), python.PyDict_New())</span><br><span class="line">      <span class="comment">// 释放当前状态</span></span><br><span class="line">        python.PyGILState_Release(_gstate)</span><br><span class="line"></span><br><span class="line">        wg.Done()</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="comment">// 获取当前的GIL并锁定</span></span><br><span class="line">        _gstate := python.PyGILState_Ensure()</span><br><span class="line">        even.Call(python.PyTuple_New(<span class="number">0</span>), python.PyDict_New())</span><br><span class="line">      <span class="comment">// 释放当前状态</span></span><br><span class="line">        python.PyGILState_Release(_gstate)</span><br><span class="line"></span><br><span class="line">        wg.Done()</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    wg.Wait()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当我们不在需要GIL的时候，在关闭python环境之前将状态重新存储并锁定GIL，然后关闭</span></span><br><span class="line">    python.PyEval_RestoreThread(state)</span><br><span class="line">    python.Finalize()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>总共就是三个步骤：</p><ol><li>Save the state and lock the GIL.</li><li>Do Python.</li><li>Restore the state and unlock the GIL.</li></ol><h1 id="六、注意事项"><a href="#六、注意事项" class="headerlink" title="六、注意事项"></a>六、注意事项</h1><h2 id="6-1-多次调用内存消耗"><a href="#6-1-多次调用内存消耗" class="headerlink" title="6.1 多次调用内存消耗"></a>6.1 多次调用内存消耗</h2><p>循环调用一个go-python函数(i.e.<code>demo</code>)内存会上升一段然后再保持平稳，理论上说没有内存泄露应该是一条直线</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">  demo(oModule)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/rwZcyk.png" alt="rwZcyk"></p><p>出现这样的原因是go的自动内存回收机制而不是出现了内存泄漏</p><h2 id="6-2-重复导包"><a href="#6-2-重复导包" class="headerlink" title="6.2 重复导包"></a>6.2 重复导包</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python3.Py_Initialize()</span><br><span class="line">python3.PyRun_SimpleString(<span class="string">"import numpy"</span>)</span><br><span class="line">python3.Py_Finalize()</span><br><span class="line">python3.Py_Initialize()</span><br><span class="line">python3.PyRun_SimpleString(<span class="string">"import numpy"</span>)</span><br><span class="line"><span class="comment">// segfault happening here</span></span><br></pre></td></tr></table></figure><p>有一些python拓展包（i.e. <code>numpy</code>）如果像上面这样重复导入会报错</p><h2 id="6-3-支持的Python"><a href="#6-3-支持的Python" class="headerlink" title="6.3 支持的Python"></a>6.3 支持的Python</h2><p>在删除了<code>PyEval_ReInitThreads</code>函数的绑定后，在Win、Mac、Linux上成功地在Python 3.8上运行了go-python3，该函数已从Python 3.8开始的Python C API中删除。我还没有用Python 3.9进行测试。</p><p>所以，结论是只当前支持python 3.7</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;参考资料：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/150253406&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://zhuanlan.zhihu.com/p/150253406&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/skyztttt/article/details/8115086&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://blog.csdn.net/skyztttt/article/details/8115086&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://poweruser.blog/embedding-python-in-go-338c0399f3d5&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://poweruser.blog/embedding-python-in-go-338c0399f3d5&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;包地址：&lt;/p&gt;
&lt;p&gt;python2：&lt;a href=&quot;https://github.com/sbinet/go-python&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/sbinet/go-python&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;python3：&lt;a href=&quot;https://github.com/DataDog/go-python3&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/DataDog/go-python3&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="technical" scheme="https://xwjahahahaha.github.io/categories/technical/"/>
    
    
    <category term="golang" scheme="https://xwjahahahaha.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>Ethermint-2-tharsis/ethermint</title>
    <link href="https://xwjahahahaha.github.io/2021/10/04/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E5%8C%BA%E5%9D%97%E9%93%BE/Cosmos/Ethermint/Ethermint-2-tharsisethermint/"/>
    <id>https://xwjahahahaha.github.io/2021/10/04/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E5%8C%BA%E5%9D%97%E9%93%BE/Cosmos/Ethermint/Ethermint-2-tharsisethermint/</id>
    <published>2021-10-04T07:51:02.000Z</published>
    <updated>2021-10-18T14:53:48.591Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><strong>记录使用tharsis/ethermint的一些操作记录与错误总结</strong></p><p><strong>注意:</strong>目前ethermint转移到了新的项目地址：<a href="https://github.com/tharsis/ethermint.git" target="_blank" rel="noopener">https://github.com/tharsis/ethermint.git</a></p><p>老的项目地址是：<a href="https://github.com/cosmos/ethermint.git，官网文档地址：https://docs.ethermint.zone" target="_blank" rel="noopener">https://github.com/cosmos/ethermint.git，官网文档地址：https://docs.ethermint.zone</a></p><p>需要注意的是<strong>官网教程对应老版本（cosmos）的ethermint</strong>, 会有所冲突。</p><p><strong>本文使用的是新版本的ethermint，另一篇是老版本的ethermint</strong>，可以看这篇 <a href="https://blog.csdn.net/weixin_43988498/article/details/120613591" target="_blank" rel="noopener">Ethermint-1-cosmos/ethermint</a></p><p>建议先按官网教程熟悉老版本！</p></blockquote><a id="more"></a><h1 id="一、tharsis-ethermint的一些改动"><a href="#一、tharsis-ethermint的一些改动" class="headerlink" title="一、tharsis/ethermint的一些改动"></a>一、tharsis/ethermint的一些改动</h1><ol><li><code>ethermintcli</code>与<code>ethermintd</code>两个命令行程序在新版本合并为了一个命令行<code>ethermintd</code>,所以之前使用的命令都在其中使用。</li><li><code>init.sh</code>程序自动会启动rest-rpc服务，不要额外启动jrpc了，默认的jrpc端口是9000</li><li>新的节点连接时会快速同步区块高度</li><li>新的日志输出样式</li></ol><p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/4z3vWU-20211005142705367.png" alt="4z3vWU"></p><h1 id="二、遇到的问题与Bug"><a href="#二、遇到的问题与Bug" class="headerlink" title="二、遇到的问题与Bug"></a>二、遇到的问题与Bug</h1><h2 id="2-1-Remix上无法部署合约"><a href="#2-1-Remix上无法部署合约" class="headerlink" title="2.1 Remix上无法部署合约"></a>2.1 Remix上无法部署合约</h2><p>问题描述：</p><p><a href="https://github.com/tharsis/ethermint/issues/79" target="_blank" rel="noopener">https://github.com/tharsis/ethermint/issues/79</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERR failed to broadcast tx error="couldn't retrieve sender address ('') from the ethereum transaction\n --- at github.com/tharsis/ethermint/app/ante/eth.go:82 (EthSigVerificationDecorator.AnteHandle) ---\nCaused by: invalid chain id for signer: tx intended signer does not match the given signer" client=json-rpc t=2021-10-05T13:17:16+0800 lvl=warn msg="Served eth_sendRawTransaction" conn=192.168.31.214:59126 reqid=9136769938060 t=3.430958ms err="couldn't retrieve sender address ('') from the ethereum transaction\n --- at github.com/tharsis/ethermint/app/ante/eth.go:82 (EthSigVerificationDecorator.AnteHandle) ---\nCaused by: invalid chain id for signer: tx intended signer does not match the given signer"</span><br></pre></td></tr></table></figure><p>原因：MetaMask上的设置chain ID与启动的rpc不匹配，导致签名失败。</p><p>解决：修改MetaMask上的设置与自己设置的chain ID匹配</p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/image-20211005142923438.png" alt="image-20211005142923438" style="zoom:67%;" /><h2 id="2-2-mykey-info-key-not-found"><a href="#2-2-mykey-info-key-not-found" class="headerlink" title="2.2 mykey.info: key not found"></a>2.2 mykey.info: key not found</h2><p>问题描述：</p><p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/image-20211005150526046.png" alt="image-20211005150526046"></p><p>原因与解决：</p><p>在使用<code>ethermintd keys</code>命令的时候如果添加账户使用的是<code>--keyring-backend=test</code>, 那么操作<code>unsafe-export-eth-key</code>也需要加上这个flag</p><p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/image-20211005150551486.png" alt="image-20211005150551486"></p><h2 id="2-3-生成交易时MetaMask报错invalid-nonce"><a href="#2-3-生成交易时MetaMask报错invalid-nonce" class="headerlink" title="2.3 生成交易时MetaMask报错invalid nonce"></a>2.3 生成交易时MetaMask报错invalid nonce</h2><p>问题描述：</p><p><a href="https://github.com/tharsis/ethermint/issues/317" target="_blank" rel="noopener">https://github.com/tharsis/ethermint/issues/317</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">creation of FSCoin errored: Error: [ethjs-query] while formatting outputs from RPC '&#123;"value":&#123;"code":-32603,"data":&#123;"code":-32000,"message":" --- at github.com/tharsis/ethermint/app/ante/eth.go:218 (EthNonceVerificationDecorator.AnteHandle) ---\nCaused by: invalid nonce; got 2, expected 1: invalid sequence"&#125;&#125;&#125;'</span><br></pre></td></tr></table></figure><h2 id="2-4-生成交易时MetaMask报错Key-not-found"><a href="#2-4-生成交易时MetaMask报错Key-not-found" class="headerlink" title="2.4 生成交易时MetaMask报错Key not found"></a>2.4 生成交易时MetaMask报错Key not found</h2><p>问题描述:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">creation of FSCoin errored: Error: [ethjs-query] while formatting outputs from RPC '&#123;"value":&#123;"code":-32603,"data":&#123;"code":-32000,"message":"rpc error: code = NotFound desc = rpc error: code = NotFound desc = account ethm10y032nunen0z6eu0msmleqk98ypjk5efdrxw9c not found: key not found"&#125;&#125;&#125;'</span><br></pre></td></tr></table></figure><p>当添加账户使用<code>--recover</code>时，在MetaMask上发起交易会找不到当前账户，但是如果是新倒入的账户（私钥）而不是<code>–recover</code>，则MetaMask可以正常使用</p><p>原因：未知，可能是MetaMask的问题</p><p>解决：不使用<code>–recover</code>，而是在第一次添加账户后，每次直接启动即可，不用<code>init.sh</code>：</p><p><code>ethermintd start --pruning=nothing —-trace --log_level info --minimum-gas-prices=0.0001aphoton --json-rpc.api eth,txpool,personal,net,debug,web3,miner</code></p><h1 id="三、自定义修改"><a href="#三、自定义修改" class="headerlink" title="三、自定义修改"></a>三、自定义修改</h1><h2 id="3-1-修改ethermint的代币aphoton为自定义代币"><a href="#3-1-修改ethermint的代币aphoton为自定义代币" class="headerlink" title="3.1 修改ethermint的代币aphoton为自定义代币"></a>3.1 修改ethermint的代币aphoton为自定义代币</h2><p>在<code>init.sh</code>中修改<code>aphoton</code>为自定义的名称</p><p>Vim: <code>%s/aphoton/[自定义名称]/g</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Change parameter token denominations to fscoin</span></span><br><span class="line">cat $HOME/.ethermintd/config/genesis.json | jq '.app_state["staking"]["params"]["bond_denom"]="aphoton"' &gt; $HOME/.ethermintd/config/tmp_genesis.json &amp;&amp; mv $HOME/.ethermintd/config/tmp_genesis.json $HOME/.ethermintd/config/genesis.json</span><br><span class="line">cat $HOME/.ethermintd/config/genesis.json | jq '.app_state["crisis"]["constant_fee"]["denom"]="aphoton"' &gt; $HOME/.ethermintd/config/tmp_genesis.json &amp;&amp; mv $HOME/.ethermintd/config/tmp_genesis.json $HOME/.ethermintd/config/genesis.json</span><br><span class="line">cat $HOME/.ethermintd/config/genesis.json | jq '.app_state["gov"]["deposit_params"]["min_deposit"][0]["denom"]="aphoton"' &gt; $HOME/.ethermintd/config/tmp_genesis.json &amp;&amp; mv $HOME/.ethermintd/config/tmp_genesis.json $HOME/.ethermintd/config/genesis.json</span><br><span class="line">cat $HOME/.ethermintd/config/genesis.json | jq '.app_state["mint"]["params"]["mint_denom"]="aphoton"' &gt; $HOME/.ethermintd/config/tmp_genesis.json &amp;&amp; mv $HOME/.ethermintd/config/tmp_genesis.json $HOME/.ethermintd/config/genesis.json</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加这一行</span></span><br><span class="line">cat $HOME/.ethermintd/config/genesis.json | jq '.app_state["evm"]["params"]["evm_denom"]="aphoton"' &gt; $HOME/.ethermintd/config/tmp_genesis.json &amp;&amp; mv $HOME/.ethermintd/config/tmp_genesis.json $HOME/.ethermintd/config/genesis.json</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;记录使用tharsis/ethermint的一些操作记录与错误总结&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;注意:&lt;/strong&gt;目前ethermint转移到了新的项目地址：&lt;a href=&quot;https://github.com/tharsis/ethermint.git&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/tharsis/ethermint.git&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;老的项目地址是：&lt;a href=&quot;https://github.com/cosmos/ethermint.git，官网文档地址：https://docs.ethermint.zone&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/cosmos/ethermint.git，官网文档地址：https://docs.ethermint.zone&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;需要注意的是&lt;strong&gt;官网教程对应老版本（cosmos）的ethermint&lt;/strong&gt;, 会有所冲突。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;本文使用的是新版本的ethermint，另一篇是老版本的ethermint&lt;/strong&gt;，可以看这篇 &lt;a href=&quot;https://blog.csdn.net/weixin_43988498/article/details/120613591&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Ethermint-1-cosmos/ethermint&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;建议先按官网教程熟悉老版本！&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="technical" scheme="https://xwjahahahaha.github.io/categories/technical/"/>
    
    
    <category term="golang" scheme="https://xwjahahahaha.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>日记_0230</title>
    <link href="https://xwjahahahaha.github.io/2021/10/02/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/%E6%97%A5%E8%AE%B0/2021-10/%E6%97%A5%E8%AE%B0-0230/"/>
    <id>https://xwjahahahaha.github.io/2021/10/02/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/%E6%97%A5%E8%AE%B0/2021-10/%E6%97%A5%E8%AE%B0-0230/</id>
    <published>2021-10-02T00:55:11.000Z</published>
    <updated>2021-10-02T03:53:26.343Z</updated>
    
    <content type="html"><![CDATA[<h2 id="学习规划"><a href="#学习规划" class="headerlink" title="学习规划:"></a>学习规划:</h2><h3 id="8月"><a href="#8月" class="headerlink" title="8月"></a>8月</h3><ul><li><input checked="" disabled="" type="checkbox"> cosmos项目架构熟悉,<del>做</del></li><li><input checked="" disabled="" type="checkbox"> <del>完全部的案例</del>,<del>并且熟悉SDK</del></li><li><input checked="" disabled="" type="checkbox"> 科技部编程比赛项目实现(使用cosmos)</li><li><input checked="" disabled="" type="checkbox"> Go公链实现项目(simple_bitcoin)</li><li><input checked="" disabled="" type="checkbox"> 专利一篇(金链积分)</li><li><input checked="" disabled="" type="checkbox"> 华为区块链比赛</li><li><input checked="" disabled="" type="checkbox"> 第一篇论文初稿(blockchain + FL)  </li></ul><a id="more"></a><h3 id="9月"><a href="#9月" class="headerlink" title="9月"></a>9月</h3><ul><li><input disabled="" type="checkbox"> 论文实验(编码实现)</li><li><input disabled="" type="checkbox"> 第一篇投稿</li><li><input disabled="" type="checkbox"> 项目一：FedSharing（Cosmos、p2p）</li></ul><h3 id="10月"><a href="#10月" class="headerlink" title="10月"></a>10月</h3><ul><li><input disabled="" type="checkbox"> go-vue-admin项目: Go网络编程(base、Echo、Gin) </li><li><input disabled="" type="checkbox"> ORM(Gorm)、数据库(mysql, PostgreSQL)、数据关系表设计</li><li><input disabled="" type="checkbox"> Go设计模式  </li><li><input disabled="" type="checkbox"> Docker </li><li><input disabled="" type="checkbox"> 容器编程k8s</li><li><input disabled="" type="checkbox"> 缓存、日志</li><li><input disabled="" type="checkbox"> 微服务(消息队列、任务调度、rpc)</li></ul><h3 id="11月"><a href="#11月" class="headerlink" title="11月"></a>11月</h3><ul><li><input disabled="" type="checkbox"> 项目二：简易Baas平台（Fabric、k8s、go-vue-admin）</li><li><input disabled="" type="checkbox"> 面经</li><li><input disabled="" type="checkbox"> 大量刷题</li></ul><h3 id="算法刷题"><a href="#算法刷题" class="headerlink" title="算法刷题"></a>算法刷题</h3><p>剑指offer刷完（47）+ 代码随想录专题（180）+ 老题目（120）$\approx$ 350（230新题 + 120老题）</p><p>11月截止，工作日：60天  =&gt; 一天4道新题 + 2道老题</p><ul><li><input disabled="" type="checkbox"> 9月底： 剑指offer结束</li><li><input disabled="" type="checkbox"> 10月底：80道新题 + 50道老题</li><li><input disabled="" type="checkbox"> 11月底：100道新题 + 70道老题</li></ul><h2 id="今日完成的任务："><a href="#今日完成的任务：" class="headerlink" title="今日完成的任务："></a>今日完成的任务：</h2><ul><li><input disabled="" type="checkbox"> 英语50词</li><li><input disabled="" type="checkbox"> Leetcode刷题：</li><li><input checked="" disabled="" type="checkbox"> FeSharing侧链80%完成</li></ul><h2 id="今日自省"><a href="#今日自省" class="headerlink" title="今日自省"></a>今日自省</h2>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;学习规划&quot;&gt;&lt;a href=&quot;#学习规划&quot; class=&quot;headerlink&quot; title=&quot;学习规划:&quot;&gt;&lt;/a&gt;学习规划:&lt;/h2&gt;&lt;h3 id=&quot;8月&quot;&gt;&lt;a href=&quot;#8月&quot; class=&quot;headerlink&quot; title=&quot;8月&quot;&gt;&lt;/a&gt;8月&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; cosmos项目架构熟悉,&lt;del&gt;做&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; &lt;del&gt;完全部的案例&lt;/del&gt;,&lt;del&gt;并且熟悉SDK&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 科技部编程比赛项目实现(使用cosmos)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; Go公链实现项目(simple_bitcoin)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 专利一篇(金链积分)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 华为区块链比赛&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 第一篇论文初稿(blockchain + FL)  &lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="随笔" scheme="https://xwjahahahaha.github.io/categories/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="每日一记" scheme="https://xwjahahahaha.github.io/categories/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/"/>
    
    
    <category term="每日一记" scheme="https://xwjahahahaha.github.io/tags/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>P2P网络编程-3-案例实践：PubSub</title>
    <link href="https://xwjahahahaha.github.io/2021/09/26/%E6%8A%80%E6%9C%AF%E8%B4%B4/GoLang/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/P2P/P2P%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-3-%E6%A1%88%E4%BE%8B%E5%AE%9E%E8%B7%B5%EF%BC%9APubSub/"/>
    <id>https://xwjahahahaha.github.io/2021/09/26/%E6%8A%80%E6%9C%AF%E8%B4%B4/GoLang/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/P2P/P2P%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-3-%E6%A1%88%E4%BE%8B%E5%AE%9E%E8%B7%B5%EF%BC%9APubSub/</id>
    <published>2021-09-26T05:59:04.000Z</published>
    <updated>2021-09-26T06:51:47.629Z</updated>
    
    <content type="html"><![CDATA[<p>libp2p网络通信中还有一种方式就是PubSub模式，也称订阅发布的模式，官方给出了订阅发布模式的一个案例=&gt; 聊天室</p><p>在此学习记录一下</p><p>官方代码地址：<a href="https://github.com/libp2p/go-libp2p/tree/master/examples/pubsub" target="_blank" rel="noopener">https://github.com/libp2p/go-libp2p/tree/master/examples/pubsub</a></p><a id="more"></a><h1 id="一、效果演示"><a href="#一、效果演示" class="headerlink" title="一、效果演示"></a>一、效果演示</h1><p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/chat-example.gif" alt="chat-example"></p><h1 id="二、代码理解"><a href="#二、代码理解" class="headerlink" title="二、代码理解"></a>二、代码理解</h1><h2 id="2-1-总体框架"><a href="#2-1-总体框架" class="headerlink" title="2.1 总体框架"></a>2.1 总体框架</h2><p>总的来说代码构成由这五个步骤：</p><img src="http://xwjpics.gumptlu.work/qinniu_uPic/image-20210926142032549.png" alt="image-20210926142032549" style="zoom:50%;" /><p>1~2两步较为简单不再赘述, 下面几点分点描述</p><h2 id="2-2-创建mDNS节点发现服务"><a href="#2-2-创建mDNS节点发现服务" class="headerlink" title="2.2 创建mDNS节点发现服务"></a>2.2 创建mDNS节点发现服务</h2><p>注意，使用mDNS作为节点发现需要保证所有的节点在同一个局域网即节点发现的范围在同一个局域网下</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// discoveryNotifee gets notified when we find a new peer via mDNS discovery</span></span><br><span class="line"><span class="comment">// 节点发现的通告结构体，继承Notifee</span></span><br><span class="line"><span class="keyword">type</span> discoveryNotifee <span class="keyword">struct</span> &#123;</span><br><span class="line">h host.Host</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HandlePeerFound connects to peers discovered via mDNS. Once they're connected,</span></span><br><span class="line"><span class="comment">// the PubSub system will automatically start interacting with them if they also</span></span><br><span class="line"><span class="comment">// support PubSub.</span></span><br><span class="line"><span class="comment">// 继承函数，节点发现后的处理函数：自动链接节点</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *discoveryNotifee)</span> <span class="title">HandlePeerFound</span><span class="params">(pi peer.AddrInfo)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">"discovered new peer %s\n"</span>, pi.ID.Pretty())</span><br><span class="line">err := n.h.Connect(context.Background(), pi)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">"error connecting to peer %s: %s\n"</span>, pi.ID.Pretty(), err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setupDiscovery creates an mDNS discovery service and attaches it to the libp2p Host.</span></span><br><span class="line"><span class="comment">// This lets us automatically discover peers on the same LAN and connect to them.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setupDiscovery</span><span class="params">(ctx context.Context, h host.Host)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// setup mDNS discovery to find local peers</span></span><br><span class="line">disc := mdns.NewMdnsService(h, DiscoveryServiceTag)</span><br><span class="line"></span><br><span class="line">n := discoveryNotifee&#123;h: h&#125;</span><br><span class="line">disc.RegisterNotifee(&amp;n)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-3-加入聊天房"><a href="#2-3-加入聊天房" class="headerlink" title="2.3 加入聊天房"></a>2.3 加入聊天房</h2><p>每个节点通过订阅房间的统一topic实现PubSub</p><h3 id="1-聊天房数据结构"><a href="#1-聊天房数据结构" class="headerlink" title="1.聊天房数据结构"></a>1.聊天房数据结构</h3><p>与一个topic一一对应，可以通过ChatRoom.Publish在topic中发布消息，并且接收所有的消息到Messages的channel中。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ChatRoom <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// Messages is a channel of messages received from other peers in the chat room</span></span><br><span class="line">Messages <span class="keyword">chan</span> *ChatMessage</span><br><span class="line"></span><br><span class="line">ctx   context.Context</span><br><span class="line">ps    *pubsub.PubSub</span><br><span class="line">topic *pubsub.Topic</span><br><span class="line">sub   *pubsub.Subscription</span><br><span class="line"></span><br><span class="line">roomName <span class="keyword">string</span></span><br><span class="line">self     peer.ID</span><br><span class="line">nick     <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChatMessage gets converted to/from JSON and sent in the body of pubsub messages.</span></span><br><span class="line"><span class="keyword">type</span> ChatMessage <span class="keyword">struct</span> &#123;</span><br><span class="line">Message    <span class="keyword">string</span></span><br><span class="line">SenderID   <span class="keyword">string</span></span><br><span class="line">SenderNick <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cr *ChatRoom)</span> <span class="title">Publish</span><span class="params">(message <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">m := ChatMessage&#123;</span><br><span class="line">Message:    message,</span><br><span class="line">SenderID:   cr.self.Pretty(),</span><br><span class="line">SenderNick: cr.nick,</span><br><span class="line">&#125;</span><br><span class="line">msgBytes, err := json.Marshal(m)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> cr.topic.Publish(cr.ctx, msgBytes)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-加入聊天房逻辑"><a href="#2-加入聊天房逻辑" class="headerlink" title="2.加入聊天房逻辑"></a>2.加入聊天房逻辑</h3><img src="http://xwjpics.gumptlu.work/qinniu_uPic/image-20210926143906101.png" alt="image-20210926143906101" style="zoom:50%;" /><p>分为三步，成功后返回一个新的ChatRoom实例</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">JoinChatRoom</span><span class="params">(ctx context.Context, ps *pubsub.PubSub, selfID peer.ID, nickname <span class="keyword">string</span>, roomName <span class="keyword">string</span>)</span> <span class="params">(*ChatRoom, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// join the pubsub topic</span></span><br><span class="line">topic, err := ps.Join(topicName(roomName))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// and subscribe to it</span></span><br><span class="line">sub, err := topic.Subscribe()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cr := &amp;ChatRoom&#123;</span><br><span class="line">ctx:      ctx,</span><br><span class="line">ps:       ps,</span><br><span class="line">topic:    topic,</span><br><span class="line">sub:      sub,</span><br><span class="line">self:     selfID,</span><br><span class="line">nick:     nickname,</span><br><span class="line">roomName: roomName,</span><br><span class="line">Messages: <span class="built_in">make</span>(<span class="keyword">chan</span> *ChatMessage, ChatRoomBufSize),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// start reading messages from the subscription in a loop</span></span><br><span class="line"><span class="keyword">go</span> cr.readLoop()</span><br><span class="line"><span class="keyword">return</span> cr, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>发布和订阅较为直观，下面是循环读取：</p><h3 id="3-循环读取消息内容"><a href="#3-循环读取消息内容" class="headerlink" title="3.循环读取消息内容"></a>3.循环读取消息内容</h3><p>循环读取内容，并将被容加入到消息channel中</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// readLoop pulls messages from the pubsub topic and pushes them onto the Messages channel.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cr *ChatRoom)</span> <span class="title">readLoop</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="comment">// Next returns the next message in our subscription</span></span><br><span class="line"><span class="comment">// 找到下一个消息</span></span><br><span class="line">msg, err := cr.sub.Next(cr.ctx)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">close</span>(cr.Messages)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// only forward messages delivered by others</span></span><br><span class="line"><span class="comment">// 只接收别人的消息</span></span><br><span class="line"><span class="keyword">if</span> msg.ReceivedFrom == cr.self &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 反序列化</span></span><br><span class="line">cm := <span class="built_in">new</span>(ChatMessage)</span><br><span class="line">err = json.Unmarshal(msg.Data, cm)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// send valid messages onto the Messages channel</span></span><br><span class="line"><span class="comment">// 把消息加入 Messages channel</span></span><br><span class="line">cr.Messages &lt;- cm</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-获取当前topic所有连接者"><a href="#4-获取当前topic所有连接者" class="headerlink" title="4.获取当前topic所有连接者"></a>4.获取当前topic所有连接者</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cr *ChatRoom)</span> <span class="title">ListPeers</span><span class="params">()</span> []<span class="title">peer</span>.<span class="title">ID</span></span> &#123;</span><br><span class="line">  <span class="comment">// ListPeers returns a list of peers we are connected to in the given topic.</span></span><br><span class="line"><span class="keyword">return</span> cr.ps.ListPeers(topicName(cr.roomName))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于UI部分不是重点，会使用即可</p><p>总体来说案例使用较为简单，可以快速上手！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;libp2p网络通信中还有一种方式就是PubSub模式，也称订阅发布的模式，官方给出了订阅发布模式的一个案例=&amp;gt; 聊天室&lt;/p&gt;
&lt;p&gt;在此学习记录一下&lt;/p&gt;
&lt;p&gt;官方代码地址：&lt;a href=&quot;https://github.com/libp2p/go-libp2p/tree/master/examples/pubsub&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/libp2p/go-libp2p/tree/master/examples/pubsub&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="technical" scheme="https://xwjahahahaha.github.io/categories/technical/"/>
    
    
    <category term="golang" scheme="https://xwjahahahaha.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>剑指Offer32-II.从上到下打印二叉树II</title>
    <link href="https://xwjahahahaha.github.io/2021/09/24/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87Offer/%E5%89%91%E6%8C%87Offer32-II-%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91II/"/>
    <id>https://xwjahahahaha.github.io/2021/09/24/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87Offer/%E5%89%91%E6%8C%87Offer32-II-%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91II/</id>
    <published>2021-09-24T13:25:00.000Z</published>
    <updated>2021-09-24T13:26:24.419Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://leetcode-cn.com/problems/cong-shang-dao-xia-da-yin-er-cha-shu-ii-lcof/" target="_blank" rel="noopener">剑指 Offer 32 - II. 从上到下打印二叉树 II</a></p><p>难度简单</p><p>从上到下按层打印二叉树，同一层的节点按从左到右的顺序打印，每一层打印到一行。</p><p>例如:<br>给定二叉树: <code>[3,9,20,null,null,15,7]</code>,</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  3</span><br><span class="line"> &#x2F; \</span><br><span class="line">9  20</span><br><span class="line">  &#x2F;  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p>返回其层次遍历结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  [3],</span><br><span class="line">  [9,20],</span><br><span class="line">  [15,7]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ol><li><code>节点总数 &lt;= 1000</code></li></ol><p>注意：本题与主站 102 题相同：<a href="https://leetcode-cn.com/problems/binary-tree-level-order-traversal/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/binary-tree-level-order-traversal/</a></p><a id="more"></a><h2 id="解题思路及代码"><a href="#解题思路及代码" class="headerlink" title="解题思路及代码"></a>解题思路及代码</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Left *TreeNode</span></span><br><span class="line"><span class="comment"> *     Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 层次遍历</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">levelOrder</span><span class="params">(root *TreeNode)</span> [][]<span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    queue, division, ret := <span class="built_in">make</span>([]*TreeNode, <span class="number">0</span>), &amp;TreeNode&#123;<span class="number">-1</span>, <span class="literal">nil</span>, <span class="literal">nil</span>&#125;, <span class="built_in">make</span>([][]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">    queue = <span class="built_in">append</span>(queue, root)</span><br><span class="line">    queue = <span class="built_in">append</span>(queue, division)</span><br><span class="line">    ret = <span class="built_in">append</span>(ret, []<span class="keyword">int</span>&#123;&#125;)</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(queue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">        node := queue[<span class="number">0</span>]</span><br><span class="line">        queue = queue[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">if</span> node == division &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(queue) &gt; <span class="number">0</span> &#123;     <span class="comment">// 注意两个if条件不能直接合并</span></span><br><span class="line">                <span class="comment">// 该层结束，创建下一个层空间</span></span><br><span class="line">                level := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">                ret = <span class="built_in">append</span>(ret, level)</span><br><span class="line">                <span class="comment">// 给下一层添加结束标记</span></span><br><span class="line">                queue = <span class="built_in">append</span>(queue, division)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 加入结果集合</span></span><br><span class="line">            ret[<span class="built_in">len</span>(ret)<span class="number">-1</span>] = <span class="built_in">append</span>(ret[<span class="built_in">len</span>(ret)<span class="number">-1</span>], node.Val)</span><br><span class="line">            <span class="comment">// 左右孩子入队</span></span><br><span class="line">            <span class="keyword">if</span> node.Left != <span class="literal">nil</span> &#123;</span><br><span class="line">                queue = <span class="built_in">append</span>(queue, node.Left)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> node.Right != <span class="literal">nil</span> &#123;</span><br><span class="line">                queue = <span class="built_in">append</span>(queue, node.Right)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://leetcode-cn.com/problems/cong-shang-dao-xia-da-yin-er-cha-shu-ii-lcof/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;剑指 Offer 32 - II. 从上到下打印二叉树 II&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;难度简单&lt;/p&gt;
&lt;p&gt;从上到下按层打印二叉树，同一层的节点按从左到右的顺序打印，每一层打印到一行。&lt;/p&gt;
&lt;p&gt;例如:&lt;br&gt;给定二叉树: &lt;code&gt;[3,9,20,null,null,15,7]&lt;/code&gt;,&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;  3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#x2F; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9  20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#x2F;  \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; 15   7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;返回其层次遍历结果：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [3],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [9,20],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [15,7]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;&lt;strong&gt;提示：&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;节点总数 &amp;lt;= 1000&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;注意：本题与主站 102 题相同：&lt;a href=&quot;https://leetcode-cn.com/problems/binary-tree-level-order-traversal/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://leetcode-cn.com/problems/binary-tree-level-order-traversal/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="technical" scheme="https://xwjahahahaha.github.io/categories/technical/"/>
    
    <category term="leetcode" scheme="https://xwjahahahaha.github.io/categories/technical/leetcode/"/>
    
    
  </entry>
  
  <entry>
    <title>剑指Offer32-I.从上到下打印二叉树</title>
    <link href="https://xwjahahahaha.github.io/2021/09/23/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87Offer/%E5%89%91%E6%8C%87Offer32-I-%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91/"/>
    <id>https://xwjahahahaha.github.io/2021/09/23/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87Offer/%E5%89%91%E6%8C%87Offer32-I-%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91/</id>
    <published>2021-09-23T05:13:46.000Z</published>
    <updated>2021-09-23T05:14:33.592Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://leetcode-cn.com/problems/cong-shang-dao-xia-da-yin-er-cha-shu-lcof/" target="_blank" rel="noopener">剑指 Offer 32 - I. 从上到下打印二叉树</a></p><p>难度中等</p><p>从上到下打印出二叉树的每个节点，同一层的节点按照从左到右的顺序打印。</p> <a id="more"></a><p>例如:<br>给定二叉树: <code>[3,9,20,null,null,15,7]</code>,</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  3</span><br><span class="line"> &#x2F; \</span><br><span class="line">9  20</span><br><span class="line">  &#x2F;  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p>返回：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[3,9,20,15,7]</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ol><li><code>节点总数 &lt;= 1000</code></li></ol><h2 id="解题思路及代码"><a href="#解题思路及代码" class="headerlink" title="解题思路及代码"></a>解题思路及代码</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Left *TreeNode</span></span><br><span class="line"><span class="comment"> *     Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 二叉树层次遍历</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">levelOrder</span><span class="params">(root *TreeNode)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    queue, ret, levelFlag := []*TreeNode&#123;&#125;, []<span class="keyword">int</span>&#123;&#125;, &amp;TreeNode&#123;<span class="number">-1</span>, <span class="literal">nil</span>, <span class="literal">nil</span>&#125;</span><br><span class="line">    <span class="comment">// 加入头节点、层结束标记</span></span><br><span class="line">    queue = <span class="built_in">append</span>(queue, root)</span><br><span class="line">    queue = <span class="built_in">append</span>(queue, levelFlag)</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(queue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="comment">// 出节点</span></span><br><span class="line">        node := queue[<span class="number">0</span>]</span><br><span class="line">        fmt.Println(node.Val)</span><br><span class="line">        queue = queue[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">if</span> node != levelFlag &#123;</span><br><span class="line">            ret = <span class="built_in">append</span>(ret, node.Val)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 节点左右孩子入队</span></span><br><span class="line">        <span class="keyword">if</span> node.Left != <span class="literal">nil</span> &#123;</span><br><span class="line">            queue = <span class="built_in">append</span>(queue, node.Left)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> node.Right != <span class="literal">nil</span> &#123;</span><br><span class="line">            queue = <span class="built_in">append</span>(queue, node.Right)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 添加层结束标记</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(queue) &gt; <span class="number">1</span> &amp;&amp; queue[<span class="number">0</span>] == levelFlag &#123;        <span class="comment">// 如果最后队列中只有一个层结束标记，那么就</span></span><br><span class="line">            <span class="comment">// 如果当前队列中下一个是层结束标记节点，那么表示此节点是当前层最后一个节点，其右孩子就是下一层的最后一个节点, 添加层结束标记</span></span><br><span class="line">            queue = <span class="built_in">append</span>(queue, levelFlag)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://leetcode-cn.com/problems/cong-shang-dao-xia-da-yin-er-cha-shu-lcof/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;剑指 Offer 32 - I. 从上到下打印二叉树&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;难度中等&lt;/p&gt;
&lt;p&gt;从上到下打印出二叉树的每个节点，同一层的节点按照从左到右的顺序打印。&lt;/p&gt;</summary>
    
    
    
    <category term="technical" scheme="https://xwjahahahaha.github.io/categories/technical/"/>
    
    <category term="leetcode" scheme="https://xwjahahahaha.github.io/categories/technical/leetcode/"/>
    
    
  </entry>
  
  <entry>
    <title>剑指Offer31.栈的压入、弹出序列</title>
    <link href="https://xwjahahahaha.github.io/2021/09/23/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87Offer/%E5%89%91%E6%8C%87Offer31-%E6%A0%88%E7%9A%84%E5%8E%8B%E5%85%A5%E3%80%81%E5%BC%B9%E5%87%BA%E5%BA%8F%E5%88%97/"/>
    <id>https://xwjahahahaha.github.io/2021/09/23/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87Offer/%E5%89%91%E6%8C%87Offer31-%E6%A0%88%E7%9A%84%E5%8E%8B%E5%85%A5%E3%80%81%E5%BC%B9%E5%87%BA%E5%BA%8F%E5%88%97/</id>
    <published>2021-09-23T02:47:47.000Z</published>
    <updated>2021-09-23T02:48:58.669Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://leetcode-cn.com/problems/zhan-de-ya-ru-dan-chu-xu-lie-lcof/" target="_blank" rel="noopener">剑指 Offer 31. 栈的压入、弹出序列</a></p><p>难度中等</p><p>输入两个整数序列，第一个序列表示栈的压入顺序，请判断第二个序列是否为该栈的弹出顺序。假设压入栈的所有数字均不相等。例如，序列 {1,2,3,4,5} 是某栈的压栈序列，序列 {4,5,3,2,1} 是该压栈序列对应的一个弹出序列，但 {4,3,5,1,2} 就不可能是该压栈序列的弹出序列。</p><p><strong>示例 1：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">输入：pushed &#x3D; [1,2,3,4,5], popped &#x3D; [4,5,3,2,1]</span><br><span class="line">输出：true</span><br><span class="line">解释：我们可以按以下顺序执行：</span><br><span class="line">push(1), push(2), push(3), push(4), pop() -&gt; 4,</span><br><span class="line">push(5), pop() -&gt; 5, pop() -&gt; 3, pop() -&gt; 2, pop() -&gt; 1</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：pushed &#x3D; [1,2,3,4,5], popped &#x3D; [4,3,5,1,2]</span><br><span class="line">输出：false</span><br><span class="line">解释：1 不能在 2 之前弹出。</span><br></pre></td></tr></table></figure> <a id="more"></a><p><strong>提示：</strong></p><ol><li><code>0 &lt;= pushed.length == popped.length &lt;= 1000</code></li><li><code>0 &lt;= pushed[i], popped[i] &lt; 1000</code></li><li><code>pushed</code> 是 <code>popped</code> 的排列。</li></ol><p>注意：本题与主站 946 题相同：<a href="https://leetcode-cn.com/problems/validate-stack-sequences/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/validate-stack-sequences/</a></p><h2 id="解题思路及代码"><a href="#解题思路及代码" class="headerlink" title="解题思路及代码"></a>解题思路及代码</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">validateStackSequences</span><span class="params">(pushed []<span class="keyword">int</span>, popped []<span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="comment">// 根据出栈顺序确定压栈顺序</span></span><br><span class="line">    stack := []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    i, j := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j&lt;<span class="built_in">len</span>(pushed) &amp;&amp; i&lt;<span class="built_in">len</span>(popped) &#123;  <span class="comment">// 循环压栈序列</span></span><br><span class="line">        <span class="keyword">if</span> pushed[j] != popped[i] &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(stack) &gt; <span class="number">0</span> &amp;&amp; popped[i] == stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>] &#123;</span><br><span class="line">                <span class="comment">// 如果当前辅助栈栈顶元素与当前考察的出栈序列中元素相同，则出栈匹配</span></span><br><span class="line">                stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">                i++</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 如果当前辅助栈为空</span></span><br><span class="line">                <span class="comment">// 或者如果当前辅助栈中栈顶元素与出栈序列数也不同，则压入辅助栈</span></span><br><span class="line">                stack = <span class="built_in">append</span>(stack, pushed[j])</span><br><span class="line">                j++</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果出栈序列元素与压栈序列元素相等，则指针同时向前一步</span></span><br><span class="line">            i++</span><br><span class="line">            j++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> j == <span class="built_in">len</span>(pushed) &amp;&amp; i &lt; <span class="built_in">len</span>(popped) &#123;</span><br><span class="line">        <span class="comment">// 压栈序列结束，出栈序列未结束，只能出辅助栈元素，一一比对</span></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">len</span>(stack) &gt; <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>] != popped[i] &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">            i++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://leetcode-cn.com/problems/zhan-de-ya-ru-dan-chu-xu-lie-lcof/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;剑指 Offer 31. 栈的压入、弹出序列&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;难度中等&lt;/p&gt;
&lt;p&gt;输入两个整数序列，第一个序列表示栈的压入顺序，请判断第二个序列是否为该栈的弹出顺序。假设压入栈的所有数字均不相等。例如，序列 {1,2,3,4,5} 是某栈的压栈序列，序列 {4,5,3,2,1} 是该压栈序列对应的一个弹出序列，但 {4,3,5,1,2} 就不可能是该压栈序列的弹出序列。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;示例 1：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;输入：pushed &amp;#x3D; [1,2,3,4,5], popped &amp;#x3D; [4,5,3,2,1]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;输出：true&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;解释：我们可以按以下顺序执行：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;push(1), push(2), push(3), push(4), pop() -&amp;gt; 4,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;push(5), pop() -&amp;gt; 5, pop() -&amp;gt; 3, pop() -&amp;gt; 2, pop() -&amp;gt; 1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;示例 2：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;输入：pushed &amp;#x3D; [1,2,3,4,5], popped &amp;#x3D; [4,3,5,1,2]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;输出：false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;解释：1 不能在 2 之前弹出。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="technical" scheme="https://xwjahahahaha.github.io/categories/technical/"/>
    
    <category term="leetcode" scheme="https://xwjahahahaha.github.io/categories/technical/leetcode/"/>
    
    
    <category term="golang" scheme="https://xwjahahahaha.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>日记_0229</title>
    <link href="https://xwjahahahaha.github.io/2021/09/23/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/%E6%97%A5%E8%AE%B0/2021-09/%E6%97%A5%E8%AE%B0-0229/"/>
    <id>https://xwjahahahaha.github.io/2021/09/23/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/%E6%97%A5%E8%AE%B0/2021-09/%E6%97%A5%E8%AE%B0-0229/</id>
    <published>2021-09-23T01:13:47.000Z</published>
    <updated>2021-09-24T00:55:04.347Z</updated>
    
    <content type="html"><![CDATA[<h2 id="学习规划"><a href="#学习规划" class="headerlink" title="学习规划:"></a>学习规划:</h2><h3 id="8月"><a href="#8月" class="headerlink" title="8月"></a>8月</h3><ul><li><input checked="" disabled="" type="checkbox"> cosmos项目架构熟悉,<del>做完全部的案例</del>,<del>并且熟悉SDK</del></li><li><input checked="" disabled="" type="checkbox"> 科技部编程比赛项目实现(使用cosmos)</li><li><input checked="" disabled="" type="checkbox"> Go公链实现项目(simple_bitcoin)</li><li><input checked="" disabled="" type="checkbox"> 专利一篇(金链积分)</li><li><input checked="" disabled="" type="checkbox"> 华为区块链比赛</li><li><input checked="" disabled="" type="checkbox"> 第一篇论文初稿(blockchain + FL)  </li></ul><a id="more"></a><h3 id="9月"><a href="#9月" class="headerlink" title="9月"></a>9月</h3><ul><li><input disabled="" type="checkbox"> 论文实验(编码实现)</li><li><input disabled="" type="checkbox"> 第一篇投稿</li><li><input disabled="" type="checkbox"> 项目一：FedSharing（Cosmos、p2p）</li></ul><h3 id="10月"><a href="#10月" class="headerlink" title="10月"></a>10月</h3><ul><li><input disabled="" type="checkbox"> go-vue-admin项目: Go网络编程(base、Echo、Gin) </li><li><input disabled="" type="checkbox"> ORM(Gorm)、数据库(mysql, PostgreSQL)、数据关系表设计</li><li><input disabled="" type="checkbox"> Go设计模式  </li><li><input disabled="" type="checkbox"> Docker </li><li><input disabled="" type="checkbox"> 容器编程k8s</li><li><input disabled="" type="checkbox"> 缓存、日志</li><li><input disabled="" type="checkbox"> 微服务(消息队列、任务调度、rpc)</li></ul><h3 id="11月"><a href="#11月" class="headerlink" title="11月"></a>11月</h3><ul><li><input disabled="" type="checkbox"> 项目二：简易Baas平台（Fabric、k8s、go-vue-admin）</li><li><input disabled="" type="checkbox"> 面经</li><li><input disabled="" type="checkbox"> 大量刷题</li></ul><h3 id="算法刷题"><a href="#算法刷题" class="headerlink" title="算法刷题"></a>算法刷题</h3><p>剑指offer刷完（47）+ 代码随想录专题（180）+ 老题目（120）$\approx$ 350（230新题 + 120老题）</p><p>11月截止，工作日：60天  =&gt; 一天4道新题 + 2道老题</p><ul><li><input disabled="" type="checkbox"> 9月底： 剑指offer结束</li><li><input disabled="" type="checkbox"> 10月底：80道新题 + 50道老题</li><li><input disabled="" type="checkbox"> 11月底：100道新题 + 70道老题</li></ul><h2 id="今日完成的任务："><a href="#今日完成的任务：" class="headerlink" title="今日完成的任务："></a>今日完成的任务：</h2><ul><li><input disabled="" type="checkbox"> 英语50词</li><li><input checked="" disabled="" type="checkbox"> Leetcode刷题：2</li><li><input checked="" disabled="" type="checkbox"> FedSharing</li></ul><h2 id="今日自省"><a href="#今日自省" class="headerlink" title="今日自省"></a>今日自省</h2>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;学习规划&quot;&gt;&lt;a href=&quot;#学习规划&quot; class=&quot;headerlink&quot; title=&quot;学习规划:&quot;&gt;&lt;/a&gt;学习规划:&lt;/h2&gt;&lt;h3 id=&quot;8月&quot;&gt;&lt;a href=&quot;#8月&quot; class=&quot;headerlink&quot; title=&quot;8月&quot;&gt;&lt;/a&gt;8月&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; cosmos项目架构熟悉,&lt;del&gt;做完全部的案例&lt;/del&gt;,&lt;del&gt;并且熟悉SDK&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 科技部编程比赛项目实现(使用cosmos)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; Go公链实现项目(simple_bitcoin)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 专利一篇(金链积分)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 华为区块链比赛&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 第一篇论文初稿(blockchain + FL)  &lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="随笔" scheme="https://xwjahahahaha.github.io/categories/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="每日一记" scheme="https://xwjahahahaha.github.io/categories/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/"/>
    
    
    <category term="每日一记" scheme="https://xwjahahahaha.github.io/tags/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>剑指Offer30.包含min函数的栈</title>
    <link href="https://xwjahahahaha.github.io/2021/09/20/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87Offer/%E5%89%91%E6%8C%87Offer30-%E5%8C%85%E5%90%ABmin%E5%87%BD%E6%95%B0%E7%9A%84%E6%A0%88/"/>
    <id>https://xwjahahahaha.github.io/2021/09/20/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87Offer/%E5%89%91%E6%8C%87Offer30-%E5%8C%85%E5%90%ABmin%E5%87%BD%E6%95%B0%E7%9A%84%E6%A0%88/</id>
    <published>2021-09-20T07:50:03.000Z</published>
    <updated>2021-09-20T07:53:48.292Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://leetcode-cn.com/problems/bao-han-minhan-shu-de-zhan-lcof/" target="_blank" rel="noopener">剑指 Offer 30. 包含min函数的栈</a></p><p>难度简单</p><p>定义栈的数据结构，请在该类型中实现一个能够得到栈的最小元素的 min 函数在该栈中，调用 min、push 及 pop 的时间复杂度都是 O(1)。</p><p><strong>示例:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MinStack minStack &#x3D; new MinStack();</span><br><span class="line">minStack.push(-2);</span><br><span class="line">minStack.push(0);</span><br><span class="line">minStack.push(-3);</span><br><span class="line">minStack.min();   --&gt; 返回 -3.</span><br><span class="line">minStack.pop();</span><br><span class="line">minStack.top();      --&gt; 返回 0.</span><br><span class="line">minStack.min();   --&gt; 返回 -2.</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ol><li>各函数的调用总次数不超过 20000 次</li></ol><p>注意：本题与主站 155 题相同：<a href="https://leetcode-cn.com/problems/min-stack/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/min-stack/</a></p><a id="more"></a><h2 id="解题思路及代码"><a href="#解题思路及代码" class="headerlink" title="解题思路及代码"></a>解题思路及代码</h2><p>使用辅助栈记录当前数据栈的状态</p><p>时间复杂度O(1)，空间复杂度O(N)</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MinStack <span class="keyword">struct</span> &#123;</span><br><span class="line">    stack []<span class="keyword">int</span></span><br><span class="line">    minStack []<span class="keyword">int</span>      <span class="comment">// 辅助记录当前最小值的栈       </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> INT_MAX = <span class="keyword">int</span>(^<span class="keyword">uint</span>(<span class="number">0</span>) &gt;&gt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/** initialize your data structure here. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">()</span> <span class="title">MinStack</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> MinStack&#123;</span><br><span class="line">        stack : <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>),</span><br><span class="line">        minStack : <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">Push</span><span class="params">(x <span class="keyword">int</span>)</span></span>  &#123;</span><br><span class="line">    <span class="comment">// 更新辅助栈</span></span><br><span class="line">    <span class="comment">// 比较辅助栈中栈顶记录的上一次的最小值与新插入的值x值之间的大小，决定本次最小值</span></span><br><span class="line">    n := <span class="built_in">len</span>(this.minStack)</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span> || x &lt; this.minStack[n<span class="number">-1</span>] &#123;</span><br><span class="line">        this.minStack = <span class="built_in">append</span>(this.minStack, x)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        this.minStack = <span class="built_in">append</span>(this.minStack, this.minStack[n<span class="number">-1</span>])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 更新数据栈</span></span><br><span class="line">    this.stack = <span class="built_in">append</span>(this.stack, x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除栈顶元素，不返回</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">Pop</span><span class="params">()</span></span>  &#123;</span><br><span class="line">    this.stack = this.stack[:<span class="built_in">len</span>(this.stack)<span class="number">-1</span>]</span><br><span class="line">    <span class="comment">// 辅助栈一直保存每一个新数插入时的状态（最小值），所以当删除一个数时同步删除一个状态即可回到上一个状态</span></span><br><span class="line">    this.minStack = this.minStack[:<span class="built_in">len</span>(this.minStack)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不删除栈顶元素，返回值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">Top</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> this.stack[<span class="built_in">len</span>(this.stack)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">Min</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> this.minStack[<span class="built_in">len</span>(this.minStack)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your MinStack object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * obj := Constructor();</span></span><br><span class="line"><span class="comment"> * obj.Push(x);</span></span><br><span class="line"><span class="comment"> * obj.Pop();</span></span><br><span class="line"><span class="comment"> * param_3 := obj.Top();</span></span><br><span class="line"><span class="comment"> * param_4 := obj.Min();</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>方法二：不允许使用额外的空间</p><pre><code class="go"></code></pre>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://leetcode-cn.com/problems/bao-han-minhan-shu-de-zhan-lcof/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;剑指 Offer 30. 包含min函数的栈&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;难度简单&lt;/p&gt;
&lt;p&gt;定义栈的数据结构，请在该类型中实现一个能够得到栈的最小元素的 min 函数在该栈中，调用 min、push 及 pop 的时间复杂度都是 O(1)。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;示例:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;MinStack minStack &amp;#x3D; new MinStack();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;minStack.push(-2);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;minStack.push(0);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;minStack.push(-3);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;minStack.min();   --&amp;gt; 返回 -3.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;minStack.pop();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;minStack.top();      --&amp;gt; 返回 0.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;minStack.min();   --&amp;gt; 返回 -2.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;&lt;strong&gt;提示：&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;各函数的调用总次数不超过 20000 次&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;注意：本题与主站 155 题相同：&lt;a href=&quot;https://leetcode-cn.com/problems/min-stack/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://leetcode-cn.com/problems/min-stack/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="technical" scheme="https://xwjahahahaha.github.io/categories/technical/"/>
    
    <category term="leetcode" scheme="https://xwjahahahaha.github.io/categories/technical/leetcode/"/>
    
    
    <category term="golang" scheme="https://xwjahahahaha.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>剑指Offer29.顺时针打印矩阵</title>
    <link href="https://xwjahahahaha.github.io/2021/09/20/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87Offer/%E5%89%91%E6%8C%87Offer29-%E9%A1%BA%E6%97%B6%E9%92%88%E6%89%93%E5%8D%B0%E7%9F%A9%E9%98%B5/"/>
    <id>https://xwjahahahaha.github.io/2021/09/20/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87Offer/%E5%89%91%E6%8C%87Offer29-%E9%A1%BA%E6%97%B6%E9%92%88%E6%89%93%E5%8D%B0%E7%9F%A9%E9%98%B5/</id>
    <published>2021-09-20T05:53:39.000Z</published>
    <updated>2021-09-20T05:55:15.943Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://leetcode-cn.com/problems/shun-shi-zhen-da-yin-ju-zhen-lcof/" target="_blank" rel="noopener">剑指 Offer 29. 顺时针打印矩阵</a></p><p>难度简单</p><p>输入一个矩阵，按照从外向里以顺时针的顺序依次打印出每一个数字。</p><p><strong>示例 1：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：matrix &#x3D; [[1,2,3],[4,5,6],[7,8,9]]</span><br><span class="line">输出：[1,2,3,6,9,8,7,4,5]</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：matrix &#x3D; [[1,2,3,4],[5,6,7,8],[9,10,11,12]]</span><br><span class="line">输出：[1,2,3,4,8,12,11,10,9,5,6,7]</span><br></pre></td></tr></table></figure><p><strong>限制：</strong></p><ul><li><code>0 &lt;= matrix.length &lt;= 100</code></li><li><code>0 &lt;= matrix[i].length &lt;= 100</code></li></ul><p>注意：本题与主站 54 题相同：<a href="https://leetcode-cn.com/problems/spiral-matrix/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/spiral-matrix/</a></p><a id="more"></a><h2 id="解题思路及代码"><a href="#解题思路及代码" class="headerlink" title="解题思路及代码"></a>解题思路及代码</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接的思路</span></span><br><span class="line"><span class="comment">// 时间复杂度O(N*M) 空间复杂度O(N*M)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">spiralOrder</span><span class="params">(matrix [][]<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    m := <span class="built_in">len</span>(matrix)</span><br><span class="line">    <span class="keyword">if</span> m == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    n := <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line">    flagMatrix := <span class="built_in">make</span>([][]<span class="keyword">bool</span>, <span class="number">0</span>)     <span class="comment">// 已访问标记数组</span></span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;m;i++ &#123;</span><br><span class="line">        flagMatrix = <span class="built_in">append</span>(flagMatrix, <span class="built_in">make</span>([]<span class="keyword">bool</span>, n))</span><br><span class="line">    &#125;</span><br><span class="line">    path, dire := []<span class="keyword">int</span>&#123;&#125;, <span class="number">1</span>    <span class="comment">// 1: 右, 2: 左, 3: 上, 4:下</span></span><br><span class="line">    <span class="keyword">for</span> i, j := <span class="number">0</span>, <span class="number">0</span>; ;&#123;</span><br><span class="line">        <span class="comment">// 向右走</span></span><br><span class="line">        <span class="keyword">if</span> dire == <span class="number">1</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> i &lt; <span class="number">0</span> || i &gt;= m || j &lt; <span class="number">0</span> || j &gt;= n || flagMatrix[i][j] &#123;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            path = <span class="built_in">append</span>(path, matrix[i][j])</span><br><span class="line">            flagMatrix[i][j] = <span class="literal">true</span></span><br><span class="line">            j++</span><br><span class="line">            <span class="keyword">if</span> j == n || flagMatrix[i][j] &#123;</span><br><span class="line">                dire = <span class="number">4</span></span><br><span class="line">                j--</span><br><span class="line">                i++</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 向下走</span></span><br><span class="line">        <span class="keyword">if</span> dire == <span class="number">4</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> i &lt; <span class="number">0</span> || i &gt;= m || j &lt; <span class="number">0</span> || j &gt;= n || flagMatrix[i][j] &#123;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            path = <span class="built_in">append</span>(path, matrix[i][j])</span><br><span class="line">            flagMatrix[i][j] = <span class="literal">true</span></span><br><span class="line">            i++</span><br><span class="line">            <span class="keyword">if</span> i == m || flagMatrix[i][j] &#123;</span><br><span class="line">                dire = <span class="number">2</span></span><br><span class="line">                i--</span><br><span class="line">                j--</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 向左走</span></span><br><span class="line">        <span class="keyword">if</span> dire == <span class="number">2</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> i &lt; <span class="number">0</span> || i &gt;= m || j &lt; <span class="number">0</span> || j &gt;= n || flagMatrix[i][j] &#123;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            path = <span class="built_in">append</span>(path, matrix[i][j])</span><br><span class="line">            flagMatrix[i][j] = <span class="literal">true</span></span><br><span class="line">            j--</span><br><span class="line">            <span class="keyword">if</span> j == <span class="number">-1</span> || flagMatrix[i][j] &#123;</span><br><span class="line">                dire = <span class="number">3</span></span><br><span class="line">                j++</span><br><span class="line">                i--</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 向上走</span></span><br><span class="line">        <span class="keyword">if</span> dire == <span class="number">3</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> i &lt; <span class="number">0</span> || i &gt;= m || j &lt; <span class="number">0</span> || j &gt;= n || flagMatrix[i][j] &#123;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            path = <span class="built_in">append</span>(path, matrix[i][j])</span><br><span class="line">            flagMatrix[i][j] = <span class="literal">true</span></span><br><span class="line">            i--</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">-1</span> || flagMatrix[i][j] &#123;</span><br><span class="line">                dire = <span class="number">1</span></span><br><span class="line">                i++</span><br><span class="line">                j++</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> path</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://leetcode-cn.com/problems/shun-shi-zhen-da-yin-ju-zhen-lcof/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;剑指 Offer 29. 顺时针打印矩阵&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;难度简单&lt;/p&gt;
&lt;p&gt;输入一个矩阵，按照从外向里以顺时针的顺序依次打印出每一个数字。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;示例 1：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;输入：matrix &amp;#x3D; [[1,2,3],[4,5,6],[7,8,9]]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;输出：[1,2,3,6,9,8,7,4,5]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;示例 2：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;输入：matrix &amp;#x3D; [[1,2,3,4],[5,6,7,8],[9,10,11,12]]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;输出：[1,2,3,4,8,12,11,10,9,5,6,7]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;&lt;strong&gt;限制：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;0 &amp;lt;= matrix.length &amp;lt;= 100&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 &amp;lt;= matrix[i].length &amp;lt;= 100&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;注意：本题与主站 54 题相同：&lt;a href=&quot;https://leetcode-cn.com/problems/spiral-matrix/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://leetcode-cn.com/problems/spiral-matrix/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="technical" scheme="https://xwjahahahaha.github.io/categories/technical/"/>
    
    <category term="leetcode" scheme="https://xwjahahahaha.github.io/categories/technical/leetcode/"/>
    
    
    <category term="golang" scheme="https://xwjahahahaha.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>日记_0228</title>
    <link href="https://xwjahahahaha.github.io/2021/09/20/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/%E6%97%A5%E8%AE%B0/2021-09/%E6%97%A5%E8%AE%B0-0228/"/>
    <id>https://xwjahahahaha.github.io/2021/09/20/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/%E6%97%A5%E8%AE%B0/2021-09/%E6%97%A5%E8%AE%B0-0228/</id>
    <published>2021-09-20T01:31:21.000Z</published>
    <updated>2021-09-23T01:13:38.059Z</updated>
    
    <content type="html"><![CDATA[<h2 id="学习规划"><a href="#学习规划" class="headerlink" title="学习规划:"></a>学习规划:</h2><h3 id="8月"><a href="#8月" class="headerlink" title="8月"></a>8月</h3><ul><li><input checked="" disabled="" type="checkbox"> cosmos项目架构熟悉,<del>做完全部的案例</del>,<del>并且熟悉SDK</del></li><li><input checked="" disabled="" type="checkbox"> 科技部编程比赛项目实现(使用cosmos)</li><li><input checked="" disabled="" type="checkbox"> Go公链实现项目(simple_bitcoin)</li><li><input checked="" disabled="" type="checkbox"> 专利一篇(金链积分)</li><li><input checked="" disabled="" type="checkbox"> 华为区块链比赛</li><li><input checked="" disabled="" type="checkbox"> 第一篇论文初稿(blockchain + FL)  </li></ul><a id="more"></a><h3 id="9月"><a href="#9月" class="headerlink" title="9月"></a>9月</h3><ul><li><input disabled="" type="checkbox"> 论文实验(编码实现)</li><li><input disabled="" type="checkbox"> 第一篇投稿</li><li><input disabled="" type="checkbox"> 项目一：FedSharing（Cosmos、p2p）</li></ul><h3 id="10月"><a href="#10月" class="headerlink" title="10月"></a>10月</h3><ul><li><input disabled="" type="checkbox"> go-vue-admin项目: Go网络编程(base、Echo、Gin) </li><li><input disabled="" type="checkbox"> ORM(Gorm)、数据库(mysql, PostgreSQL)、数据关系表设计</li><li><input disabled="" type="checkbox"> Go设计模式  </li><li><input disabled="" type="checkbox"> Docker </li><li><input disabled="" type="checkbox"> 容器编程k8s</li><li><input disabled="" type="checkbox"> 缓存、日志</li><li><input disabled="" type="checkbox"> 微服务(消息队列、任务调度、rpc)</li></ul><h3 id="11月"><a href="#11月" class="headerlink" title="11月"></a>11月</h3><ul><li><input disabled="" type="checkbox"> 项目二：简易Baas平台（Fabric、k8s、go-vue-admin）</li><li><input disabled="" type="checkbox"> 面经</li><li><input disabled="" type="checkbox"> 大量刷题</li></ul><h3 id="算法刷题"><a href="#算法刷题" class="headerlink" title="算法刷题"></a>算法刷题</h3><p>剑指offer刷完（47）+ 代码随想录专题（180）+ 老题目（120）$\approx$ 350（230新题 + 120老题）</p><p>11月截止，工作日：60天  =&gt; 一天4道新题 + 2道老题</p><ul><li><input disabled="" type="checkbox"> 9月底： 剑指offer结束</li><li><input disabled="" type="checkbox"> 10月底：80道新题 + 50道老题</li><li><input disabled="" type="checkbox"> 11月底：100道新题 + 70道老题</li></ul><h2 id="今日完成的任务："><a href="#今日完成的任务：" class="headerlink" title="今日完成的任务："></a>今日完成的任务：</h2><ul><li><input checked="" disabled="" type="checkbox"> 英语50词</li><li><input checked="" disabled="" type="checkbox"> Leetcode刷题：2</li><li><input checked="" disabled="" type="checkbox"> FedSharing</li></ul><h2 id="今日自省"><a href="#今日自省" class="headerlink" title="今日自省"></a>今日自省</h2>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;学习规划&quot;&gt;&lt;a href=&quot;#学习规划&quot; class=&quot;headerlink&quot; title=&quot;学习规划:&quot;&gt;&lt;/a&gt;学习规划:&lt;/h2&gt;&lt;h3 id=&quot;8月&quot;&gt;&lt;a href=&quot;#8月&quot; class=&quot;headerlink&quot; title=&quot;8月&quot;&gt;&lt;/a&gt;8月&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; cosmos项目架构熟悉,&lt;del&gt;做完全部的案例&lt;/del&gt;,&lt;del&gt;并且熟悉SDK&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 科技部编程比赛项目实现(使用cosmos)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; Go公链实现项目(simple_bitcoin)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 专利一篇(金链积分)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 华为区块链比赛&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 第一篇论文初稿(blockchain + FL)  &lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="随笔" scheme="https://xwjahahahaha.github.io/categories/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="每日一记" scheme="https://xwjahahahaha.github.io/categories/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/"/>
    
    
    <category term="每日一记" scheme="https://xwjahahahaha.github.io/tags/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>剑指Offer28.对称的二叉树</title>
    <link href="https://xwjahahahaha.github.io/2021/09/17/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87Offer/%E5%89%91%E6%8C%87Offer28-%E5%AF%B9%E7%A7%B0%E7%9A%84%E4%BA%8C%E5%8F%89%E6%A0%91/"/>
    <id>https://xwjahahahaha.github.io/2021/09/17/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87Offer/%E5%89%91%E6%8C%87Offer28-%E5%AF%B9%E7%A7%B0%E7%9A%84%E4%BA%8C%E5%8F%89%E6%A0%91/</id>
    <published>2021-09-17T07:25:39.000Z</published>
    <updated>2021-09-17T07:29:38.845Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://leetcode-cn.com/problems/dui-cheng-de-er-cha-shu-lcof/" target="_blank" rel="noopener">剑指 Offer 28. 对称的二叉树</a></p><p>难度简单</p><p>请实现一个函数，用来判断一棵二叉树是不是对称的。如果一棵二叉树和它的镜像一样，那么它是对称的。</p><p>例如，二叉树 [1,2,2,3,4,4,3] 是对称的。</p><p><code>1  / \ 2  2 / \ / \3  4 4  3</code><br>但是下面这个 [1,2,2,null,3,null,3] 则不是镜像对称的:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &#x2F; \ 2  2  \  \  3   3</span><br></pre></td></tr></table></figure><p><strong>示例 1：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：root &#x3D; [1,2,2,3,4,4,3]</span><br><span class="line">输出：true</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：root &#x3D; [1,2,2,null,3,null,3]</span><br><span class="line">输出：false</span><br></pre></td></tr></table></figure><p><strong>限制：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 &lt;&#x3D; 节点个数 &lt;&#x3D; 1000</span><br></pre></td></tr></table></figure><p>注意：本题与主站 101 题相同：<a href="https://leetcode-cn.com/problems/symmetric-tree/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/symmetric-tree/</a></p><a id="more"></a><h2 id="解题思路及代码"><a href="#解题思路及代码" class="headerlink" title="解题思路及代码"></a>解题思路及代码</h2><p>核心思路：对称二叉树的前序遍历与修改的前序遍历(中-&gt;右-&gt;左)是相同的。</p><p>注意点：</p><ol><li>对于左右仅有一个子树的节点来说，空的子节点也需要设置一个特殊值放入遍历结果中（本题使用-1）</li><li>go语言中，函数传递切片时，如果函数中使用了append，则一定要传递切片的指针，否则一旦append越界拓展，原切片不会改动。</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Left *TreeNode</span></span><br><span class="line"><span class="comment"> *     Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isSymmetric</span><span class="params">(root *TreeNode)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    ft, mft := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>), <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="comment">// 如果对称则两种遍历结果相同</span></span><br><span class="line">    first_traverse(root, &amp;ft)   <span class="comment">// 注意2: 0长度切片作为函数参数传递时，函数中使用append要传递指针，否则append后是新的切片，原切片不会改变</span></span><br><span class="line">    modify_first_traverse(root, &amp;mft) </span><br><span class="line">    <span class="keyword">for</span> i, v := <span class="keyword">range</span> ft &#123;</span><br><span class="line">        <span class="keyword">if</span> mft[i] != v &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中-&gt;左-&gt;右</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">first_traverse</span><span class="params">(root *TreeNode, ft *[]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">// 注意1：当一边为空子树的时候也要加入遍历数组中</span></span><br><span class="line">        *ft = <span class="built_in">append</span>(*ft, <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    *ft = <span class="built_in">append</span>(*ft, root.Val)</span><br><span class="line">    <span class="keyword">if</span> root.Left != <span class="literal">nil</span> || root.Right != <span class="literal">nil</span> &#123;</span><br><span class="line">        first_traverse(root.Left, ft)</span><br><span class="line">        first_traverse(root.Right, ft)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中-&gt;右-&gt;左</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">modify_first_traverse</span><span class="params">(root *TreeNode, mft *[]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        *mft = <span class="built_in">append</span>(*mft, <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    *mft = <span class="built_in">append</span>(*mft, root.Val)</span><br><span class="line">    <span class="keyword">if</span> root.Left != <span class="literal">nil</span> || root.Right != <span class="literal">nil</span> &#123;</span><br><span class="line">        modify_first_traverse(root.Right, mft)</span><br><span class="line">        modify_first_traverse(root.Left, mft)   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://leetcode-cn.com/problems/dui-cheng-de-er-cha-shu-lcof/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;剑指 Offer 28. 对称的二叉树&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;难度简单&lt;/p&gt;
&lt;p&gt;请实现一个函数，用来判断一棵二叉树是不是对称的。如果一棵二叉树和它的镜像一样，那么它是对称的。&lt;/p&gt;
&lt;p&gt;例如，二叉树 [1,2,2,3,4,4,3] 是对称的。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;1  / \ 2  2 / \ / \3  4 4  3&lt;/code&gt;&lt;br&gt;但是下面这个 [1,2,2,null,3,null,3] 则不是镜像对称的:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1  &amp;#x2F; \ 2  2  \  \  3   3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;&lt;strong&gt;示例 1：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;输入：root &amp;#x3D; [1,2,2,3,4,4,3]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;输出：true&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;示例 2：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;输入：root &amp;#x3D; [1,2,2,null,3,null,3]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;输出：false&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;&lt;strong&gt;限制：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;0 &amp;lt;&amp;#x3D; 节点个数 &amp;lt;&amp;#x3D; 1000&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;注意：本题与主站 101 题相同：&lt;a href=&quot;https://leetcode-cn.com/problems/symmetric-tree/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://leetcode-cn.com/problems/symmetric-tree/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="technical" scheme="https://xwjahahahaha.github.io/categories/technical/"/>
    
    <category term="leetcode" scheme="https://xwjahahahaha.github.io/categories/technical/leetcode/"/>
    
    
    <category term="golang" scheme="https://xwjahahahaha.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>剑指Offer27.二叉树的镜像</title>
    <link href="https://xwjahahahaha.github.io/2021/09/17/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87Offer/%E5%89%91%E6%8C%87Offer27-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%95%9C%E5%83%8F/"/>
    <id>https://xwjahahahaha.github.io/2021/09/17/%E6%8A%80%E6%9C%AF%E8%B4%B4/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87Offer/%E5%89%91%E6%8C%87Offer27-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%95%9C%E5%83%8F/</id>
    <published>2021-09-17T03:08:57.000Z</published>
    <updated>2021-09-17T03:10:02.367Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://leetcode-cn.com/problems/er-cha-shu-de-jing-xiang-lcof/" target="_blank" rel="noopener">剑指 Offer 27. 二叉树的镜像</a></p><p>请完成一个函数，输入一个二叉树，该函数输出它的镜像。</p><p>例如输入：</p><pre><code>4</code></pre><p>   /   <br>  2     7<br> / \   / <br>1   3 6   9<br>镜像输出：</p><pre><code>4</code></pre><p>   /   <br>  7     2<br> / \   / <br>9   6 3   1</p><p>示例 1：</p><p>输入：root = [4,2,7,1,3,6,9]<br>输出：[4,7,2,9,6,3,1]</p><p>限制：</p><p>0 &lt;= 节点个数 &lt;= 1000</p><p>注意：本题与主站 226 题相同：<a href="https://leetcode-cn.com/problems/invert-binary-tree/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/invert-binary-tree/</a></p><a id="more"></a><h2 id="解题思路及代码"><a href="#解题思路及代码" class="headerlink" title="解题思路及代码"></a>解题思路及代码</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Left *TreeNode</span></span><br><span class="line"><span class="comment"> *     Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mirrorTree</span><span class="params">(root *TreeNode)</span> *<span class="title">TreeNode</span></span> &#123;</span><br><span class="line">    exchange(root)</span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 先序遍历同时交换左右子树</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exchange</span><span class="params">(root *TreeNode)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> </span><br><span class="line">    &#125;</span><br><span class="line">    root.Left, root.Right = root.Right, root.Left</span><br><span class="line">    exchange(root.Left)</span><br><span class="line">    exchange(root.Right)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://leetcode-cn.com/problems/er-cha-shu-de-jing-xiang-lcof/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;剑指 Offer 27. 二叉树的镜像&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;请完成一个函数，输入一个二叉树，该函数输出它的镜像。&lt;/p&gt;
&lt;p&gt;例如输入：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;4&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;   /   &lt;br&gt;  2     7&lt;br&gt; / \   / &lt;br&gt;1   3 6   9&lt;br&gt;镜像输出：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;4&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;   /   &lt;br&gt;  7     2&lt;br&gt; / \   / &lt;br&gt;9   6 3   1&lt;/p&gt;
&lt;p&gt;示例 1：&lt;/p&gt;
&lt;p&gt;输入：root = [4,2,7,1,3,6,9]&lt;br&gt;输出：[4,7,2,9,6,3,1]&lt;/p&gt;
&lt;p&gt;限制：&lt;/p&gt;
&lt;p&gt;0 &amp;lt;= 节点个数 &amp;lt;= 1000&lt;/p&gt;
&lt;p&gt;注意：本题与主站 226 题相同：&lt;a href=&quot;https://leetcode-cn.com/problems/invert-binary-tree/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://leetcode-cn.com/problems/invert-binary-tree/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="technical" scheme="https://xwjahahahaha.github.io/categories/technical/"/>
    
    <category term="leetcode" scheme="https://xwjahahahaha.github.io/categories/technical/leetcode/"/>
    
    
    <category term="golang" scheme="https://xwjahahahaha.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>日记_0227</title>
    <link href="https://xwjahahahaha.github.io/2021/09/17/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/%E6%97%A5%E8%AE%B0/2021-09/%E6%97%A5%E8%AE%B0-0227/"/>
    <id>https://xwjahahahaha.github.io/2021/09/17/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/%E6%97%A5%E8%AE%B0/2021-09/%E6%97%A5%E8%AE%B0-0227/</id>
    <published>2021-09-17T00:39:33.000Z</published>
    <updated>2021-09-20T01:31:03.797Z</updated>
    
    <content type="html"><![CDATA[<h2 id="学习规划"><a href="#学习规划" class="headerlink" title="学习规划:"></a>学习规划:</h2><h3 id="8月"><a href="#8月" class="headerlink" title="8月"></a>8月</h3><ul><li><input checked="" disabled="" type="checkbox"> cosmos项目架构熟悉,<del>做完全部的案例</del>,<del>并且熟悉SDK</del></li><li><input checked="" disabled="" type="checkbox"> 科技部编程比赛项目实现(使用cosmos)</li><li><input checked="" disabled="" type="checkbox"> Go公链实现项目(simple_bitcoin)</li><li><input checked="" disabled="" type="checkbox"> 专利一篇(金链积分)</li><li><input checked="" disabled="" type="checkbox"> 华为区块链比赛</li><li><input checked="" disabled="" type="checkbox"> 第一篇论文初稿(blockchain + FL)  </li></ul><a id="more"></a><h3 id="9月"><a href="#9月" class="headerlink" title="9月"></a>9月</h3><ul><li><input disabled="" type="checkbox"> 论文实验(编码实现)</li><li><input disabled="" type="checkbox"> 第一篇投稿</li><li><input disabled="" type="checkbox"> 项目一：FedSharing（Cosmos、p2p）</li></ul><h3 id="10月"><a href="#10月" class="headerlink" title="10月"></a>10月</h3><ul><li><input disabled="" type="checkbox"> go-vue-admin项目: Go网络编程(base、Echo、Gin) </li><li><input disabled="" type="checkbox"> ORM(Gorm)、数据库(mysql, PostgreSQL)、数据关系表设计</li><li><input disabled="" type="checkbox"> Go设计模式  </li><li><input disabled="" type="checkbox"> Docker </li><li><input disabled="" type="checkbox"> 容器编程k8s</li><li><input disabled="" type="checkbox"> 缓存、日志</li><li><input disabled="" type="checkbox"> 微服务(消息队列、任务调度、rpc)</li></ul><h3 id="11月"><a href="#11月" class="headerlink" title="11月"></a>11月</h3><ul><li><input disabled="" type="checkbox"> 项目二：简易Baas平台（Fabric、k8s、go-vue-admin）</li><li><input disabled="" type="checkbox"> 面经</li><li><input disabled="" type="checkbox"> 大量刷题</li></ul><h3 id="算法刷题"><a href="#算法刷题" class="headerlink" title="算法刷题"></a>算法刷题</h3><p>剑指offer刷完（47）+ 代码随想录专题（180）+ 老题目（120）$\approx$ 350（230新题 + 120老题）</p><p>11月截止，工作日：60天  =&gt; 一天4道新题 + 2道老题</p><ul><li><input disabled="" type="checkbox"> 9月底： 剑指offer结束</li><li><input disabled="" type="checkbox"> 10月底：80道新题 + 50道老题</li><li><input disabled="" type="checkbox"> 11月底：100道新题 + 70道老题</li></ul><h2 id="今日完成的任务："><a href="#今日完成的任务：" class="headerlink" title="今日完成的任务："></a>今日完成的任务：</h2><ul><li><input checked="" disabled="" type="checkbox"> 英语50词</li><li><input checked="" disabled="" type="checkbox"> Leetcode刷题：2题</li><li><input checked="" disabled="" type="checkbox"> FedSharing</li></ul><h2 id="今日自省"><a href="#今日自省" class="headerlink" title="今日自省"></a>今日自省</h2>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;学习规划&quot;&gt;&lt;a href=&quot;#学习规划&quot; class=&quot;headerlink&quot; title=&quot;学习规划:&quot;&gt;&lt;/a&gt;学习规划:&lt;/h2&gt;&lt;h3 id=&quot;8月&quot;&gt;&lt;a href=&quot;#8月&quot; class=&quot;headerlink&quot; title=&quot;8月&quot;&gt;&lt;/a&gt;8月&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; cosmos项目架构熟悉,&lt;del&gt;做完全部的案例&lt;/del&gt;,&lt;del&gt;并且熟悉SDK&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 科技部编程比赛项目实现(使用cosmos)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; Go公链实现项目(simple_bitcoin)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 专利一篇(金链积分)&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 华为区块链比赛&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 第一篇论文初稿(blockchain + FL)  &lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="随笔" scheme="https://xwjahahahaha.github.io/categories/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="每日一记" scheme="https://xwjahahahaha.github.io/categories/%E9%9A%8F%E7%AC%94/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/"/>
    
    
    <category term="每日一记" scheme="https://xwjahahahaha.github.io/tags/%E6%AF%8F%E6%97%A5%E4%B8%80%E8%AE%B0/"/>
    
  </entry>
  
</feed>
